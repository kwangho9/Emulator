<!DOCTYPE HTML>
<html lang="ko">
    <head>
        <meta charset="utf-8">
        <title>STA Emulator</title>
        <link rel="stylesheet" href="styles/style.css">
        <link rel="stylesheet" href="styles/button.css">
        <!--
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></script>
        <script type="text/javascript" src="constants/jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="constants/xlsx.full.min.js"></script>
        <script type="text/javascript" src="constants/constants.js"></script>
        <script type="text/javascript" src="./Bank Map.json"></script>
        <script type="text/javascript" src="./Wafer Map.json"></script>
        -->
        <script type="text/javascript" src="constants/constants.json"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <!--
        <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></script>
        -->
        <style>
            .CommandBox {
                width: 160px;
            }
            .OpcodeBox {
                width: 100px;
            }
        </style>
    </head>

    <body>
        <center>
		<div style="width:100%;">
        <section class="container" style="display:inline-block">
        <strong><label for="id-device" class="labeltext text">Device</label></strong>
        <div id='deviceBox' class="dropdown" style="display:inline-block">
        <select id="id-device" name="Device" class="dropdown-select" style='background-color: powderblue;'>
            <optgroup label="1st Gen STA">
            <option value='STA-1.01A' style='background-color:sandybrown'>STA-1.01A</option>
            <option value='STA-2' style='background-color:sandybrown'>STA-2</option>
            <option value='STA-201' style='background-color:sandybrown'>STA-2.01</option>
            <option value='STA-3B' style='background-color:sandybrown'>STA-3B</option>
            <option value='STA-FX' style='background-color:sandybrown; display:none'>STA-FX</option>
            <option value='STA-FX2' style='background-color:sandybrown; display:none'>STA-FX2</option>
            <option value='STA-FX3' style='background-color:lightgreen; display:none'>STA-FX3</option>
            <optgroup label="2nd Gen STA">
            <option value='STA-10' style='background-color:sandybrown'>STA-10</option>
            <option value='STA-20' style='background-color:sandybrown'>STA-20</option>
            <option value='STA-30' style='background-color:sandybrown; display:none'>STA-30</option>
            <option value='STA-N' style='background-color:sandybrown' selected='selected'>STA-N</option>
            <option value='STA-X' style='background-color:sandybrown; display:none'>STA-X</option>
            <option value='STA-3X' style='background-color:sandybrown'>STA-3X</option>
            <option value='STA-XF' style='background-color:sandybrown'>STA-XF</option>
            <option value='MCC16' style='background-color:sandybrown'>MCC16</option>
            <option value='HSS32' style='background-color:lightgreen; display:none'>HSS32</option>
            <option value='HSS64' style='background-color:lightgreen; display:none'>HSS64</option>
            <optgroup label="Other">
            <option value='PS1120' style='background-color:sandybrown'>PS1120</option>
            <option value='PS1060' style='background-color:sandybrown'>PS1060</option>
            <option value='PS1030' style='background-color:sandybrown; display:none'>PS1030</option>
            <option value='PS2064' style='background-color:sandybrown'>PS2064</option>
            <!--
            <option value='SP2003' style='background-color:sandybrown' selected='selected'>SP2003</option>
            -->
            <option value='SP2003' style='background-color:sandybrown'>SP2003</option>
            <option value='LPS1001' style='background-color:lightgreen'>LPS1001</option>
            <option value='LPS1002' style='background-color:lightgreen; display:none'>LPS1002</option>
            <option value='LPS2002' style='background-color:lightgreen; display:none'>LPS2002</option>
            <option value='LPS2004' style='background-color:lightgreen; display:none'>LPS2004</option>
        </select>
        </div>      <!-- dropdown -->


        <div id='STACommand' class='Command' style='display:inline-block'>
        <label for="oldCommand" class="labeltext text"><strong>Command</strong></label>
        <div class="CommandBox dropdown" style="width:100px; display:inline-block">
        <select id="oldCommand" name="LogicCommand" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <optgroup label='1-clock command'>
            <option value="0x00" style='background-color:lightgreen' selected="selected">NORMAL</option>
            <option value="0x01" style='background-color:lightgreen'>LOAD_ALL</option>
            <option value="0x02" style='background-color:lightgreen'>VIRTUAL</option>
            <option value="0x03" style='background-color:yellow'>CLEAR_ALL</option>
            <option value="0x04" style='background-color:yellow'>ENABLE_ALL</option>
            <option value="0x05" style='background-color:yellow'>INITIAL_ALL</option>
            <optgroup label='2-clock command'>
            <option value="0x10" style='background-color:sandybrown'>AND_CRL</option>
            <option value="0x11" style='background-color:sandybrown'>OR_CRL</option>
            <option value="0x12" style='background-color:sandybrown'>DIRECT_CRL</option>
            <option value="0x13" style='background-color:sandybrown'>DIRECT_CHL</option>
            <option value="0x14" style='background-color:sandybrown'>REJECT_CRL</option>
            <option value="0x18" style='background-color:sandybrown'>AND_SWL</option>
            <option value="0x19" style='background-color:sandybrown'>OR_SWL</option>
            <option value="0x1A" style='background-color:sandybrown'>DIRECT_SWL</option>
            <option value="0x1C" style='background-color:sandybrown'>REJECT_SWL</option>
            <option value="0x1D" style='background-color:sandybrown'>CANCEL_RJT</option>
        </select>
        <select id="newCommand" name="LogicCommand" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <optgroup label='1-clock command'>
            <option value="0x02" style='background-color:lightgreen' selected="selected">RESET_ALL</option>
            <option value="0x03" style='background-color:lightgreen'>CLEAR_ALL</option>
            <option value="0x04" style='background-color:lightgreen'>ENABLE_ALL</option>
            <option value="0x05" style='background-color:lightgreen'>INITIAL_ALL</option>
            <option value="0x0B" style='background-color:yellow'>EN1_WCON</option>
            <option value="0x0C" style='background-color:yellow'>EN2_WCON</option>
            <option value="0x0D" style='background-color:yellow'>DIS_WCON</option>
            <optgroup label='2-clock command'>
            <option value="0x12" style='background-color:sandybrown'>DIRECT_CHP_COR</option>
            <option value="0x13" style='background-color:sandybrown'>DIRECT_BNK_COR</option>
            <option value="0x14" style='background-color:sandybrown'>REJECT_CHP_COR</option>
            <option value="0x15" style='background-color:sandybrown'>DIRECT_CHP_CHN</option>
            <option value="0x16" style='background-color:sandybrown'>DIRECT_BNK_CHN</option>
            <option value="0x17" style='background-color:sandybrown'>REJECT_CHP_CHN</option>
            <option value="0x1A" style='background-color:sandybrown'>DIRECT_COR_SW</option>
            <option value="0x1B" style='background-color:sandybrown'>DIRECT_CHN_SW</option>
            <option value="0x1C" style='background-color:sandybrown'>REJECT_COR_SW</option>
            <option value="0x1D" style='background-color:sandybrown'>REJECT_CHN_SW</option>
            <option value="0x11" style='background-color:yellow'>WR_GCON</option>
            <option value="0x18" style='background-color:yellow'>WR_CLCON</option>
            <option value="0x19" style='background-color:yellow'>WR_TSDCON</option>
        </select>
        </div>      <!-- CommandBox dropdown -->
        </div>      <!-- STACommand -->

        <div id='PSxxxxCmdField' class='Command' style='display:inline-block'>
        <strong><label for="spiCommand" class="labeltext text">Select</label></strong>
        <div class="SelectBox dropdown" style="width:100px; display:inline-block">
        <select id="PSxxxxCommand" name="LogicCommand" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <optgroup label='All Chip'>
            <option value="0x00" style='background-color:lightgreen'>All Swithes</option>
            <option value="0x01" style='background-color:lightgreen'>Single Switch</option>
            <option value="0x02" style='background-color:lightgreen'>Row</option>
            <option value="0x03" style='background-color:lightgreen'>Row & Column</option>
            <option value="0x04" style='background-color:yellow'>Column</option>
            <option value="0x05" style='background-color:yellow'>Column & Row</option>
            <option value="0x06" style='background-color:yellow' selected='selected'>Special</option>
            <option value="0x07" style='background-color:yellow'>Switches</option>
            <optgroup label='Single Chip'>
            <option value="0x08" style='background-color:sandybrown'>All Swithes</option>
            <option value="0x09" style='background-color:sandybrown'>Signel Swith</option>
            <option value="0x0A" style='background-color:sandybrown'>Row</option>
            <option value="0x0B" style='background-color:sandybrown'>Row & Column</option>
            <option value="0x0C" style='background-color:sandybrown'>Column</option>
            <option value="0x0D" style='background-color:sandybrown'>Column & Row</option>
            <option value="0x0E" style='background-color:sandybrown'>Special</option>
            <option value="0x0F" style='background-color:sandybrown'>Switches</option>
        </select>
        </div>      <!-- SelectBox dropdown -->
        <div id='OpcodeField' style='display:inline-block'>
        <strong><label for="Opcode" class="labeltext text">Opcode</label></strong>
        <div class="OptionBox dropdown" style="width:120px; display:inline-block">
        <select id="Opcode" name="Opcodes" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <option value="0x0" style='background-color:lightgreen' selected="selected">SWITCH OFF</option>
            <option value="0x1" style='background-color:lightgreen'>SWITCH ON</option>
            <option value="0x2" style='background-color:lightgreen'>HOLD OFF</option>
            <option value="0x3" style='background-color:lightgreen'>HOLD ON</option>
            <option value="0x4" style='background-color:yellow'>RELEASE OFF</option>
            <option value="0x5" style='background-color:yellow'>RELEASE ON</option>
            <option value="0x6" style='background-color:yellow'>FORCE OFF</option>
            <option value="0x7" style='background-color:yellow'>FORCE ON</option>
        </select>
        </div>      <!-- OptionBox dropdown -->
        </div>      <!-- OpcodeField -->
        <div id='FunctionField' class='Select' style='display:none'>
        <strong><label for="Function" class="labeltext text">Function</label></strong>
        <div class="FunctionBox dropdown" style="width:120px; display:inline-block">
        <select id="Function" name="Functions" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <option value="0x1" style='background-color:lightgreen'>Group Type</option>
            <option value="0x2" style='background-color:yellow'>Software Reset</option>
            <option value="0x4" style='background-color:yellow'>AD Disable</option>
            <option value="0x5" style='background-color:yellow'>AD Enable</option>
            <option value="0x7" style='background-color:yellow' selected='selected'>Address Assignment</option>
        </select>
        </div>      <!-- FunctionBox dropdown -->
        </div>      <!-- FunctionField dropdown -->
        </div>      <!-- PSxxxxCmdField dropdown -->
        <div id='SP2003CmdField' class='Command' style='display:inline-block'>
        <strong><label for="SP2003Command" class="labeltext text">Command</label></strong>
        <div class="SelectBox dropdown" style="width:120px; display:inline-block">
        <select id="SP2003Command" name="LogicCommand" class='dropdown-select' style='background-color: powderblue; display:inline-block'>
            <optgroup label='Samsung Command'>
            <option value="0xA0" style='background-color:lightgreen'>INIT Off</option>
            <option value="0xA1" style='background-color:lightgreen'>INIT On</option>
            <option value="0xA2" style='background-color:lightgreen'>CL Enable</option>
            <option value="0xA3" style='background-color:lightgreen'>CL Disable</option>
            <option value="0xA4" style='background-color:yellow'>All Chip Pair Channel</option>
            <option value="0xA5" style='background-color:yellow'>Single Chip Pair Channel</option>
            <option value="0xA6" style='background-color:yellow'>Single Chip Each Channel</option>
            <option value="0xA7" style='background-color:yellow'>Single Chip Reject</option>
            <option value="0xA8" style='background-color:yellow'>Multi Chip Pair Channel</option>
            <option value="0xA9" style='background-color:yellow'>LDO Level Set</option>
            <optgroup label='Special Command'>
            <option value="0xAD" style='background-color:sandybrown'>TRIM SFR Control</option>
            <option value="0xAE" style='background-color:sandybrown'>Channel SFR Control</option>
            <option value="0xAF" style='background-color:sandybrown' selected='selected'>Address Assignment</option>
            <optgroup label='Channel SFR Command'>
            <option value="0xAA" style='background-color:sandybrown'>Channel SFR Control</option>
        </select>
        </div>      <!-- SelectBox dropdown -->
        </div>      <!-- Command -->
        </section>

        <!-- STA Command Parameter element -->
        <div id='ChipID' class="Parameter labeltext text" style='display:none;'>
            <b>Chip ID</b>
            <input type='number' id='ChipNum' class='input-number' min=0 max=31 step=1 value=0 placeholder='Chip ID' style='width:40px'>
        </div>
        <div id='CoreID' class="Parameter labeltext text" style='display:none;'>
            <b>Core ID</b>
            <input type='number' id='CoreNum' class='input-number' min=0 max=7 step=1 value=0 placeholder='Core ID' style='width:40px'>
        </div>
        <div id='WData' class="Parameter labeltext text" style='display:none;'>
            <b>Data</b>
            <input id='DataNum' class='input-number' value=0xA5 placeholder='Hex Data' style='width:40px'>
        </div>

        <!-- PS1120/PS1060/PS1030 Command Parameter element -->
        <div id='ChipField' class="Parameter labeltext text" style='display:none;'>
            <b>Chip</b>
            <!--
            <input type=number id='ChipSelect' class='input-number' min=0 max=255 step=1 value=64 style='width:40px'>
            -->
            <input id='ChipSelect' class='input-number' value=0x40 placeholder='Hex Data' style='width:40px'>
        </div>
        <div id='RowField' class="Parameter labeltext text" style='display:none;'>
            <b>Row</b>
            <input id='RowSelect' class='input-number' value=0x200 placeholder='Hex Data' style='width:40px'>
        </div>
        <div id='ColumnField' class="Parameter labeltext text" style='display:none;'>
            <b>Column</b>
            <input id='ColumnSelect' class='input-number' value=0x800 placeholder='Hex Data' style='width:40px'>
        </div>
        <div id='NumberField' class="Parameter labeltext text" style='display:none;'>
            <b>Switch</b>
            <input type=number id='NumberSelect' class='input-number' min=0 max=119 step=1 value=0 style='width:40px'>
        </div>
        <div id='SwitchField' class="Parameter labeltext text" style='display:none;'>
            <b>Switches</b>
            <input id='SwitchSelect' class='input-number' value='0x1' placeholder='Decimal' style='width:200px'>
        </div>
        <div id='GroupField' class="Parameter labeltext text" style='display:none;'>
            <b>Group</b>
            <input id='GroupNumber' class='input-number' value=3 placeholder='Decimal' style='width:40px'>
        </div>
        <div id='MaskField' class="Parameter labeltext text" style='display:none;'>
            <b>ADDR Mask</b>
            <input id='MaskSelect' class='input-number' value=0xFF placeholder='Hex Data' style='width:40px'>
        </div>

        <!-- SP2003 Command Parameter element -->
        <div id='ChipNumberField' class="Parameter labeltext text" style='display:none;'>
            <b>Chip</b>
            <input type=number id='ChipNumber' class='input-number' min=0 max=15 step=1 value=0 placeholder='Decimal' style='width:40px'>
        </div>
        <div id='ChipSelectField' class="Parameter labeltext text" style='display:none;'>
            <b>Select</b>
            <input id='ChipSelect16' class='input-number' value=0x8000 placeholder='Hex Data' style='width:80px'>
        </div>
        <div id='Ctrl1Field' class="Parameter labeltext text" style='display:none;'>
            <b>Ctrl-1</b>
            <input type=number id='Ctrl1Value' class='input-number' min=0 max=7 step=1 value=7 style='width:40px'>
        </div>
        <div id='Ctrl2Field' class="Parameter labeltext text" style='display:none;'>
            <b>Ctrl-2</b>
            <input type=number id='Ctrl2Value' class='input-number' min=0 max=7 step=1 value=7 style='width:40px'>
            <b>Ctrl-3</b>
            <input type=number id='Ctrl3Value' class='input-number' min=0 max=7 step=1 value=7 style='width:40px'>
        </div>
        <div id='Ctrl4Field' class="Parameter labeltext text" style='display:none;'>
            <b>Ctrl-4</b>
            <input type=number id='Ctrl4Value' class='input-number' min=0 max=15 step=1 value=7 style='width:40px'>
        </div>
        <div id='LevelField' class="Parameter labeltext text" style='display:none;'>
            <b>Level</b>
            <input id='LevelValue' class='input-number' value=1200 placeholder='Decimal' style='width:80px'>
        </div>
        <div id='CtrlField' class="Parameter labeltext text" style='display:none;'>
            <b>Control</b>
            <!--
            <input id='CtrlValue' class='input-number' value=0x80 placeholder='Hex Data' style='width:40px'>
            -->
            <input type="radio" id="CtrlEnable" name='EnableDisable' class='input-number' value="Enable">
            <label for="CtrlEnable">Enable</label>
            <input type="radio" id="CtrlDisable" name='EnableDisable' class='input-number' value="Disable">
            <label for="CtrlDisable">Disable</label>
        </div>
        <!--
        <div id='ChipID' class="labeltext text" style='display:inline-block;'>
            <b>Chip ID</b>
            <input type='number' id='ChipNum' class='input-number' min=0 max=31 step=1 value=0 placeholder='Chip ID' style='width:40px'>
        </div>
        <div id='CoreID' class="labeltext text" style='display:inline-block;'>
            <b>Core ID</b>
            <input type='number' id='CoreNum' class='input-number' min=0 max=7 step=1 value=0 placeholder='Core ID' style='width:40px'>
        </div>
        <div id='WData' class="labeltext text" style='display:inline-block;'>
            <b>Data</b>
            <input id='DataNum' class='input-number' value=0xA5 placeholder='Hex Data' style='width:40px'>
        </div>
        -->
        &emsp;
        <input type="button" class='button green' id="send" value="Send">
        </br>
        <input type="button" class='button teal' id="package" value="Package">
        <input type="button" class='button purple' id="feature" value="Feature">
        <input type="button" class='button blue_alt' id="datasheet" value="Datasheet">
        <input type="button" class='button crisp' id="overview" value="Overview">
		</div>
        </br>
        </br>

        <div id='tooltip' style='position:absolute; display:none;'></div>
        <div id='svgContainer1' name='container' align="center"></div>
        <div id='svgContainer2' name='container' align="center"></div>
        <div id='svgContainer3' name='container' align="center"></div>
        </center>


        <script type="text/javascript">
            const xmlns = "http://www.w3.org/2000/svg";
            const FirstDeviceList = ['STA-1.01A', 'STA-2', 'STA-201', 'STA-3B', 'STA-FX', 'STA-FX2', 'STA-FX3'];
            const SecondDeviceList = ['MCC16', 'STA-N', 'STA-10', 'STA-20', 'STA-30', 'STA-X', 'STA-3X', 'STA-XF'];
            const ThirdDeviceList = ['PS1120', 'PS1060', 'PS1030', 'SP2003', 'PS2064', 'LPS1001'];
            const Channel128_DeviceList = ['STA-XF', 'STA-3X', 'STA-X', 'STA-FX', 'STA-FX2'];
            const MCC16_Valid_Switch = [4, 6, 10, 12, 16, 20, 26, 28, 30, 36, 40, 42, 48, 54, 60, 62];
            const RowColumn = [ [[4, 30], [6, 20], [8, 15], [10, 12], [12, 10], [16, 8]],
                                [[4, 15], [6, 10], [8, 8], [10, 6], [12, 5], [16, 4]],
                                [[4, 8], [6, 5], [8, 4], [10, 3], [12, 3], [16, 2]]
                              ];
            const BitMask = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80];

            var BankMap;
            var first = 1;
            var deviceName;

            var maxChip = 8;
            var svg1;
            var svg2;
            var svg3;
            $('#ChipSelect').on('change', function(e) {
                var nValue = e.target.value;
                var oValue = $('#ChipSelect').data('old');
                console.log(`${oValue} -> ${nValue}`);

                if( oValue === 'undefined' ) {
                }

                e.target.value = (oValue << 1) | 0x1;
                if( e.target.value == 0xF ) e.target.value = 0x0;
                console.log(`${e.target.value}`);

                $('#ChipSelect').data('old', e.target.value);
            });
//            $(document).ready(function(){
            $(function(){
                first = 1;

                /*
                // Object Array에서 특정 Member의 값을 check하는 방법.
                var valid = MyObjectArray.some(sw => sw.PinNumber === 1);
                console.log(`valid = ${valid}`);
                // Object Array에서 특정 Member에 대해서 주어진 값을 갖는 Array의 index를 구하는 방법.
                var index = MyObjectArray.findIndex(object => { return object.LogicNumber === 4; });
                console.log(`index = ${index}`);
                */
                $('#id-device').val("STA-1.01A");

                var color = $('#id-device').find('option:selected').css('background-color');
                $('#id-device').css({'background-color':color});

                deviceName = $('#id-device').val();
                console.log(deviceName);

                createWindow(deviceName);

                // 브라우저의 Window 크기에 맞추어서 svg영역을 재설정한다.
                var w = $(window).width();
                var h = $(window).height();
//                console.log(`window size : (${w} x ${h})`);

//                $('#ProbeCard').width(w-30);
//                $('#ProbeCard').height(h-100);
//                console.log(`inner size : ${$('#ProbeCard').innerWidth()} x ${$('#ProbeCard').innerHeight()}`);
//                console.log(`rect width = ${$('#Card').width()}`);
//                console.log('SelectedDut : ', SelectedDut);

                console.log($('#PreviousBank').attr('viewBox'));
                var tmp = $('#PreviousBank').attr('viewBox').split(/\s+|,/);
                viewBox.x = parseInt(tmp[0]);
                viewBox.y = parseInt(tmp[1]);
                viewBox.w = parseInt(tmp[2]);
                viewBox.h = parseInt(tmp[3]);
                console.log(viewBox);
                clientWidth = $('#PreviousBank').width();
                clientHeight = $('#PreviousBank').height();
            });

            var isAdjust = true;
            var isPanning = false;
            var clientWidth;
            var clientHeight;
            var scale = 1;
            const delta = 10;
            var viewBox = {x:0, y:0, w:0, h:0};
            // 브라우저 windows의 크기를 변경하면 Call된다.
            $(window).resize( function() {
                var w = $(window).width();
                var h = $(window).height();

                clientWidth = $('#PreviousBank').width();
                clientHeight = $('#PreviousBank').height();
//                $("#ProbeCard").width(w-30);
//                $("#ProbeCard").height(h-100);

//            console.log(`inner size : ${$('#ProbeCard').innerWidth()} x ${$('#ProbeCard').innerHeight()}`);
            });

            // up/down/left/right key event.
            $(document).keydown( function(e) {
                console.log(`key down event : ${e.which}`);
                if( e.which == 37 ) {               // left key.
                } else if( e.which == 38 ) {        // up key.
                } else if( e.which == 39 ) {        // right key.
                } else if( e.which == 40 ) {        // down key.
                } else if( e.which == 187 ) {       // shift + '+' key.
                } else if( e.which == 189 ) {       // shift + '-' key.
                }
            });

            $(document).keypress( function(e) {
                console.log(`keypress event : ${e.type}, ${e.target.value}, ${e.keyCode}\n`);
                    console.log(viewBox);
                if( (e.keyCode == 43) || (e.keyCode == 45) ) {
                    var w = viewBox.w;
                    var h = viewBox.h;
                    var mx = w / 2;//e.pageX;
                    var my = h / 2;//e.pageY;    
                    var d = 1;
                    if( e.keyCode == 43 ) {         // '+' key
                        d = 100;
                    } else if( e.keyCode == 45 ) {  // '-' key
                        d = -100;
                    }
//                    var deltaY = e.originalEvent.wheelDelta;
                    var dw = w*Math.sign(d)*0.05;
                    var dh = h*Math.sign(d)*0.05;
                    console.log(`dw = ${dw}, dh = ${dh}`);

                    var dx = (dw * mx) / clientWidth;
                    var dy = (dh * my) / clientHeight;
                    console.log(`dx = ${dx}, dy = ${dy}`);
                    viewBox = {x:viewBox.x+dx, y:viewBox.y+dy, w:viewBox.w-dw, h:viewBox.h-dh};
                    scale = $('#PreviousBank').width()/viewBox.w;
                    console.log(viewBox);
//        console.log(`${Math.round(scale*100)/100} -> `);
                    $('#PreviousBank').attr('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
//                    $('.dutName').each(function(index, item) {
//                        $(item).attr("visibility", ((scale > 2) ? "visible" : "hidden"));
//                    });
                }
            });

            $(document).on('mousewheel mousedown mouseup mouseleave mousemove', '#PreviousBank', function(e) {
//                console.log(`${e.type} event : `);
//                console.log(`mouse point : offset, page = (${e.offsetX}, ${e.offsetY}), (${e.pageX}, ${e.pageY})\n`);
//    console.log(`viewBox = ${JSON.stringify(viewBox)}\n`);
//    console.log(e.type+' ');
                if( isAdjust == false ) return;

//    console.log('viewBox = ' + JSON.stringify(viewBox)+'\n');
                if( e.type == 'mousemove' ) {
                    if (isPanning){
                        endPoint = {x:e.pageX,y:e.pageY};
                        var dx = (startPoint.x - endPoint.x)/scale;
                        var dy = (startPoint.y - endPoint.y)/scale;
                        $('#ProbeCard').attr('viewBox', `${viewBox.x+dx} ${viewBox.y+dy} ${viewBox.w} ${viewBox.h}`);
                    }
                } else if( e.type == 'mousewheel' ) {
//        console.log(`wheel data = ${e.originalEvent.wheelDelta}\n`);
//        console.log(`SVG width, height : ${$('#ProbeCard').width()}, ${$('#ProbeCard').height()}\n`);
//        e.preventDefault();

                    var deltaY = e.originalEvent.wheelDelta;
                    var w = viewBox.w;
                    var h = viewBox.h;
                    var mx = e.pageX;
                    var my = e.pageY;    
                    var dw;
                    var dh;
//        console.log(`mx = ${mx}, my = ${my}\n`);
                    if(e.shiftKey == true) {
                        dw = w*Math.sign(deltaY)*0.5;
                        dh = h*Math.sign(deltaY)*0.5;
                    } else if(e.ctrlKey == true) {
                        dw = w*Math.sign(deltaY)*0.1;
                        dh = h*Math.sign(deltaY)*0.1;
                    } else {
                        dw = w*Math.sign(deltaY)*0.1;
                        dh = h*Math.sign(deltaY)*0.1;
                    }
                    var dx = (dw * mx) / clientWidth;
                    var dy = (dh * my) / clientHeight;
                    viewBox = {x:viewBox.x+dx, y:viewBox.y+dy, w:viewBox.w-dw, h:viewBox.h-dh};
                    scale = $('#ProbeCard').width()/viewBox.w;
//        console.log(`${Math.round(scale*100)/100} -> `);
                    $('#ProbeCard').attr('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
                    $('.dutName').each(function(index, item) {
                        $(item).attr("visibility", ((scale > 2) ? "visible" : "hidden"));
                    });
//        console.log(`deltaY = ${e.originalEvent.wheelDelta}, key(ctrl, shift, alt) = (${e.ctrlKey}, ${e.shiftKey}, ${e.altKey})\n`);
                } else if( e.type == 'mouseleave' ) {
                    isPanning = false;
                } else if( e.type == 'mousedown' ) {
                    isPanning = true;
                    startPoint = {x:e.pageX,y:e.pageY};
                } else if( e.type == 'mouseup' ) {
                    if (isPanning){ 
                        endPoint = {x:e.pageX,y:e.pageY};
                        var dx = (startPoint.x - endPoint.x)/scale;
                        var dy = (startPoint.y - endPoint.y)/scale;
                        viewBox = {x:viewBox.x+dx,y:viewBox.y+dy,w:viewBox.w,h:viewBox.h};
//            console.log(`mouseup : viewBox = ${JSON.stringify(viewBox)}\n`);
                        $('#ProbeCard').attr('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);
                        isPanning = false;
                    }
                } else {
                    console.log('mouse unknowned\n');
                }
            });





            function showTooltip(event, chip, sw) {
//                console.log(event);
//                console.log(`chip = ${chip}, sw = ${sw}`);

                let tooltip = document.getElementById('tooltip');
                var channel = BankMap.Banks[0].Devices[chip].Switches[sw];
                if( deviceName == 'SP2003' ) {
                    if( (sw == 0) || (sw == 3) ) {
                        tooltip.innerHTML = `OnOff = ${channel.OnOff}, Reject = ${channel.Reject}`;
                    } else {
                        tooltip.innerHTML = `OnOff = ${channel.OnOff}, Reject = ${channel.Reject}, Level = ${channel.Level/1000}V`;
                    }
                } else {
                    tooltip.innerHTML = `OnOff = ${channel.OnOff}, Reject = ${channel.Reject}`;
                }
                tooltip.style.display = 'block';
                tooltip.style.left = event.pageX + 'px';
                tooltip.style.top = event.pageY + 'px';
//                console.log(`value = ${event.target.getAttribute('value')} mouse enter event x = ${event.pageX}, y = ${event.pageY}\n`);
            }

            function hideTooltip(event) {
                let tooltip = document.getElementById('tooltip');
                tooltip.style.display = 'none';
//                console.log(`mouse out event x = ${event.pageX}, y = ${event.pageY}\n`);
            }

            function createWindow(name) {
                console.log(`device Name : ${name}`);
                initalBankMap(name);

                changeDevice(name);

                drawBank(0);
            }

            function initalBankMap(name) {
                BankMap = new Object();
                BankMap.device = name;
                BankMap.Banks = [];
                BankMap.BankCnt = 2;
                if( ThirdDeviceList.includes(deviceName) ) {
                    for(var bank=0; bank<BankMap.BankCnt; bank++) {
                        var Bank = new Object();
                        Bank.DeviceCnt = 8;
                        if( name == 'PS1120' ) {
                            Bank.DeviceType = 0;    // 0(PS1120), 1(PS1060), 2(PS1030)
                        } else if( name == 'PS1060' ) {
                            Bank.DeviceType = 1;    // 0(PS1120), 1(PS1060), 2(PS1030)
                        } else if( name == 'PS1030' ) {
                            Bank.DeviceType = 2;    // 0(PS1120), 1(PS1060), 2(PS1030)
                        } else if( name == 'SP2003' ) {
                            Bank.DeviceType = 3;    // 0(PS1120), 1(PS1060), 2(PS1030), 3(SP2003)
                            Bank.DeviceCnt = 16;
                            Bank.Ctrl = 0;              // 0xA4, 0xA5, 0xA6, 0xA7, 0xA8, 0xAD, 0xAE
                            Bank.Chip = 0;
//                            Bank.ChipSelect = 0;        // 0xA8, 0xAF command.
//                            Bank.Data = 0;              // 0xA9
                        }
                        Bank.Cmd = 0;           // 0 ~ 0xFF
                        Bank.ChipSelect = 0;    // 0x1 ~ 0xFF
                        Bank.RowSelect = 0;     // 0x1 ~ 0x3FF (@PS1120, 10분기)
                        Bank.ColumnSelect = 0;  // 0x1 ~ 0xFFF (@PS1120, 10분기)
                        Bank.Data = 0;           // 0 ~ 0xFF
                        Bank.Switches = [];     // 0 ~ 0xFF
                        Bank.Devices = [];
                        for(var dev=0; dev<Bank.DeviceCnt; dev++) {
                            var Device = new Object();
                            Device.ID = 'x';
                            Device.AD = false;          // AD(Active Discharge)
                            if( name == 'SP2003' ) {
                                Device.ChannelSFR = false;          // ChannelSFR access flag.
                                Device.TrimSFR = false;          // TrimSFR access flag.
                                Device.CL = false;          // CL(Clipping)
                                Device.nChannel = 6;
                                Device.nCore = 1;
                                Device.nSwitch = 6;
                                Device.Switches = [];
                                for(var sw=0; sw<Device.nSwitch; sw++) {
                                    var Switch = new Object();
                                    Switch.Number = sw;
                                    Switch.Valid = true;
                                    Switch.OnOff = 0;                   // OFF : 0, ON : 1
                                    Switch.Reject = 1;                  // REJECT : 0, RELEASE : 1
                                    if( (sw == 0) || (sw == 3) ) {
                                        Switch.Level = 3300;
                                    } else {
                                        Switch.Level = 1200;
                                    }
                                    Device.Switches.push(Switch);
                                }
                            } else {
                                Device.GROUP = 3;       // 0(4분기), 1(6분기), 2(8분기), 3(10분기), 4(12분기), 5(16분기)
//                            Device.nRow = RowColumn[Bank.DeviceType][Device.GROUP][0];
//                            Device.nColumn = RowColumn[Bank.DeviceType][Device.GROUP][1];
                                Device.nChannel = RowColumn[Bank.DeviceType][Device.GROUP][0];      // nRow
                                Device.nCore = RowColumn[Bank.DeviceType][Device.GROUP][1];         // nColumn
                                Device.nSwitch = ((Bank.DeviceType == 0) ? 120 : ((Bank.DeviceType == 1) ? 60 : 30));
                                Device.Switches = [];
                                for(var sw=0; sw<Device.nSwitch; sw++) {
                                    var Switch = new Object();
                                    Switch.Number = sw;
                                    Switch.Valid = true;
                                    Switch.OnOff = 0;                   // OFF : 0, ON : 1
                                    Switch.Reject = 1;                  // REJECT : 0, RELEASE : 1
                                    Device.Switches.push(Switch);
                                }
                            }
                            Bank.Devices.push(Device);
                        }
                        BankMap.Banks.push(Bank);
                    }
                } else {
                    for(var bank=0; bank<BankMap.BankCnt; bank++) {
                        var Bank = new Object();
                        Bank.DeviceCnt = 32;
                        Bank.Chip = 0;          // 0 ~ 31, 32(All)
                        Bank.Core = 0;          // 0 ~ 7
                        Bank.Cmd = 0;           // 0 ~ 0xF
                        Bank.Data = 0;          // 0 ~ 0xFF
                        Bank.Devices = [];
                        for(var dev=0; dev<Bank.DeviceCnt; dev++) {
                            var Device = new Object();
                            Device.ID = dev;
                            Device.GCON = 0;
                            Device.CLCON = 0;
                            Device.TSDCON = 0;
                            Device.WriteEnable = 0;
                            Device.nCore = 8;
                            Device.nChannel = (name == 'STA-1.01A') ? 4 : 8;
                            Device.Switches = [];
                            for(var sw=0; sw<(Device.nCore*Device.nChannel); sw++) {
                                var Switch = new Object();
                                Switch.Number = sw;
                                if( name === 'MCC16') {
                                    Switch.Valid = MCC16_Valid_Switch.includes(sw);
                                } else if( name === 'STA-10' ) {
                                    Switch.Valid = (sw & 0x1) ? false : true;
                                } else {
                                    Switch.Valid = true;
                                }
                                Switch.OnOff = 0;                   // OFF : 0, ON : 1
                                Switch.Reject = 1;                  // REJECT : 0, RELEASE : 1
                                Device.Switches.push(Switch);
                            }
                            Bank.Devices.push(Device);
                        }
                        BankMap.Banks.push(Bank);
                    }
                }
                console.log(BankMap);
            }

            function drawBank(state) {      // 0 : Before State, 1 : After State.
                var svg = document.createElementNS(xmlns, 'svg');

                svg1 = svg;
                if( state == 1 ) svg3 = svg;      // After state.

                document.getElementById((state == 1) ? 'svgContainer3' : 'svgContainer1').innerHTML = ""; // 기존 svg에 그려진 element를 제거한다.

                // drawing svg
                var svgWidth = 730;
                var svgHeight = (deviceName == 'STA-1.01A') ? 120 : 190;
                var widthView = '100%';
                var heightView = '100%';
                if( ThirdDeviceList.includes(deviceName) ) {
                    svgHeight = 230;
                    if( deviceName == 'PS1120' ) {
                        svgWidth = 1050;
//                        widthView = '100%';
//                        heightView = '100%';
                    } else if( deviceName == 'PS1060' ) {
                        svgWidth = 580;
//                        svgHeight = 230;
                        widthView = '50%';
//                        heightView = '100%';
                    } else if( deviceName == 'PS1030' ) {
                        svgWidth = 340;
//                        svgHeight = 230;
                        widthView = '30%';
//                        heightView = '100%';
                    } else if( deviceName == 'SP2003' ) {
                        svgWidth = 668;
                        svgHeight = 160;
//                        widthView = '100%';
//                        heightView = '100%';
                    }
                }

                $(svg).attr({
                    id:(state == 0)?'PreviousBank':'NextBank', align:'center', width:widthView, height:heightView,
                    viewBox:`0 0 ${svgWidth} ${svgHeight}`
                });

                if( state == 0 ) {      // Before state.
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:0, y:0, width:svgWidth, height:svgHeight,
                        fill:'transparent', stroke:'gray', 'stroke-width':'1',
                    }).appendTo(svg);
                }

                var x = 5;
                var y = 5;
                var w = (svgWidth / 2) - 10;
                var h = svgHeight - 10;

                var nCore = BankMap.Banks[0].Devices[0].nCore;
                var nChannel = BankMap.Banks[0].Devices[0].nChannel;
                if( deviceName == 'SP2003' ) {
                    nCore = 16;
                    nChannel = 6;

                    w = svgWidth - 20;
                    x = 10;
                    console.log(`nCore = ${nCore}, nChannel = ${nChannel}`);

                    drawSP2003Bank(svg, 0, nCore, nChannel, x, y, w, h);        // Bank-0, Chip[0:15]
                } else {
                    console.log(`nCore = ${nCore}, nChannel = ${nChannel}`);

                    // 128-channel Device check.
                    if( Channel128_DeviceList.includes(deviceName) ) {
                        $(document.createElementNS(xmlns, 'text')).attr({
                            x:x+w+7, y:y+8, class:'centerAlign', 'font-size':9
                        }).text(`${deviceName}`).appendTo(svg);

                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:x-2, y:y-2, width:(w*2)+14, height:h+4,
                            fill:'transparent', stroke:'black', 'stroke-width':1,
                        }).appendTo(svg);
                    }
                    drawDevice(svg, 1, nCore, nChannel, x, y, w, h);
                    drawDevice(svg, 2, nCore, nChannel, x+w+10, y, w, h);
                }

                document.getElementById((state == 1) ? 'svgContainer3' : 'svgContainer1').appendChild(svg);
            }

            function drawSP2003Bank(svg, chip, nCore, nChannel, sx, sy, sw, sh) {
                console.log(`drawSP2003Bank() : nCore = ${nCore}, nChannel = ${nChannel}`);
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:sx+(sw/2), y:sy+(6), class:'centerAlign', 'font-size':8
                }).text('BANK[0]').appendTo(svg);
                $(document.createElementNS(xmlns, 'rect')).attr({
                    x:sx, y:sy, width:sw, height:sh,
                    fill:'transparent', stroke:'black', 'stroke-width':1,
                }).appendTo(svg);

                    var x = sx + 10;
                    var y = sy + 10;
                    for(var chip=0; chip<BankMap.Banks[0].DeviceCnt; chip++) {
                        y = sy + 20;
                        // insert text.
                        // draw rect.
                        $(document.createElementNS(xmlns, 'text')).attr({
                            x:x+(28/2), y:y-(5), class:'centerAlign', 'font-size':8,
                        }).text(`SP2003`).appendTo(svg);
                        $(document.createElementNS(xmlns, 'text')).attr({
                            x:x+(28/2), y:y+(7), class:'centerAlign', 'font-size':8,
                        }).text(`[${BankMap.Banks[0].Devices[chip].ID}]`).appendTo(svg);
                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:x, y:y, width:28, height:(18*nChannel)+12, value:`chip${chip}`,
                            fill:'transparent', stroke:'black', 'stroke-width':1,
                            onclick:((svg == svg1) ? `toggleCore(${chip}, ${chip})` : ''),
                        }).appendTo(svg);
                        for(var channel=0; channel<nChannel; channel++) {
                            y += 18;
                            if( (channel == 0) || (channel == 3) ) {
                                drawSwitch(svg, chip, channel, x, y);  // ctrl: 0(OFF), 1(ON), 2(REJECT)
                            } else {
                                drawLdo(svg, chip, channel, x, y);  // ctrl: 0(OFF), 1(ON), 2(REJECT)
                            }
                        }
                        x += 40;
                    }


                if( svg == svg3 ) {
//                    if( ThirdDeviceList.includes(deviceName) ) {
                console.log('SP2003');
                        activeSP2003(svg, chip, sx, sy, sw, sh);
//                    } else {
//                        activeDevice(svg, chip, sx, sy, sw, sh);
//                    }
                }
            }

            function drawDevice(svg, chip, nCore, nChannel, sx, sy, sw, sh) {
                // 128-channel Device check.
                if( Channel128_DeviceList.includes(deviceName) ) {
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:sx+(sw/2), y:sy+(10), class:'centerAlign', 'font-size':8
                    }).text(`${(chip & 0x1)? 'Bottom' : 'Top'} [ID=${chip}]`).appendTo(svg);

                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx, y:sy, width:sw, height:sh,
                        fill:'transparent', stroke:'black', 'stroke-dasharray':'1,1', 'stroke-width':1,
                    }).appendTo(svg);
                } else {
                    var id;
                    if( ThirdDeviceList.includes(deviceName) ) {        // PS1120, PS1060, PS1030
                        id = BankMap.Banks[0].Devices[chip].ID;
                    } else {
                        id = chip;
                    }
                    console.log(`id = ${id}`);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:sx+(sw/2), y:sy+(10), class:'centerAlign', 'font-size':8
                    }).text(`${deviceName} [ID=${id}]`).appendTo(svg);

                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx, y:sy, width:sw, height:sh,
                        fill:'transparent', stroke:(ChipID == chip)?'red':'black', 'stroke-width':1,
                    }).appendTo(svg);
                }

                var x = sx + 35;
                var y = sy + 10;
                var n;
                for(var core=0; core<nCore; core++) {
                    y = sy + 20;
                    // insert text.
                    // draw rect.
                    if( ThirdDeviceList.includes(deviceName) ) {        // PS1120, PS1060, PS1030
                        n = nCore - (core + 1);
                    } else {
                        n = core;
                    }
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+(28/2), y:y+(7), class:'centerAlign', 'font-size':8,
                    }).text(`Col ${n}`).appendTo(svg);
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:x, y:y, width:28, height:(18*nChannel)+12, value:`core${core}`,
                        fill:'transparent', stroke:'black', 'stroke-width':1,
                        onclick:((svg == svg1) ? `toggleCore(${chip}, ${core})` : ''),
                    }).appendTo(svg);
                    for(var channel=0; channel<nChannel; channel++) {
                        y += 18;
                        if( core == 0 ) {
                            if( ThirdDeviceList.includes(deviceName) ) {        // PS1120, PS1060, PS1030
                                $(document.createElementNS(xmlns, 'text')).attr({
                                    x:sx+15, y:y, class:'centerAlign', 'font-size':8,
                                }).text(`Row ${nChannel-(channel+1)}`).appendTo(svg);
                            } else {
                                $(document.createElementNS(xmlns, 'text')).attr({
                                    x:sx+15, y:y, class:'centerAlign', 'font-size':8,
                                }).text(`Ch ${channel}`).appendTo(svg);
                            }
                        }
                        drawSwitch(svg, chip, (core * nChannel) + channel, x, y);  // ctrl: 0(OFF), 1(ON), 2(REJECT)
                    }
                    x += 40;
                }


                if( svg == svg3 ) {
                    if( ThirdDeviceList.includes(deviceName) ) {
                        activeDevice2(svg, chip, sx, sy, sw, sh);
                    } else {
                        activeDevice(svg, chip, sx, sy, sw, sh);
                    }
                }
            }

                /* Old STA Command Type.
                 * Type 1 : all chip, all core, all switch.
                 *          SINGLE COMMAND.
                 * Type 2 : single chip, all core, selected switch in core. - CRL
                 *          AND_CRL(0x10), OR_CRL(0x11), DIRECT_CRL(0x12)
                 * Type 3 : all chip, all core, selected switch in core. - CHL
                 *          DIRECT_CHL(0x13)
                 * Type 4 : single chip, selected cores, all switch. - REJECT_CRL
                 *          REJECT_CRL(0x14)
                 * Type 5 : single chip, single core, selected switch in core.
                 *          AND_SWL(0x18), OR_SWL(0x19), DIRECT_SWL(0x1A), REJECT_SWL(0x1C), CANCEL_RJT(0x1D)
                 */
                /* New STA Command Type.
                 * Type 1 : all chip, all core, all switch.
                 *          SINGLE COMMAND
                 * Type 2 : single chip, all core, selected switch in core. - CRL
                 *          DIRECT_CHP_COR(0x12), DIRECT_CHIP_CHN(0x15) 
                 * Type 3 : all chip, all core, selected switch in core. - CHL
                 *          DIRECT_BNK_COR(0x13), DIRECT_BNK_CHN(0x16)
                 * Type 4 : single chip, selected cores, all switch. - REJECT_CRL
                 *          REJECT_CHP_COR(0x14), REJECT_CHP_CHN(0x17)
                 * Type 5 : single chip, single core, selected switch in core. - REJECT_CRL
                 *          DIRECT_COR_SW(0x1A), DIRECT_CHN_SW(0x1B), REJECT_COR_SW(0x1C), REJECT_CHN_SW(0x1D)
                 *
                 *          WR_GCON(0x11), WR_CLCON(0x18), WR_TSDCON(0x19) : single chip, data is register value.
                 */

            function activeDevice(svg, chip, sx, sy, sw, sh) {
                var type = 0;   // 1 : all chip, all core, all switch.
                                // 2 : all chip, selected core.
                                // 3 : all chip, selected channel.
                                // 4 : selected chip, all core.
                                // 5 : selected chip, all channel.
                                // 6 : selected chip, selected core.
                                // 7 : selected chip, selected channel.
                var cmd = BankMap.Banks[0].Cmd;
                var nChannel = BankMap.Banks[0].Devices[0].nChannel;
                var nCore = BankMap.Banks[0].Devices[0].nCore;
                if( FirstDeviceList.includes(BankMap.device) ) {
                    if( cmd < 0x10 ) {
                        type = 1;
                    } else if( (cmd == 0x10) || (cmd == 0x11) || (cmd == 0x12) ) {
                        type = 2;
                    } else if( (cmd == 0x13) ) {
                        type = 3;
                    } else if( (cmd == 0x14) ) {
                        type = 4;
                    } else if( (cmd == 0x18) || (cmd == 0x19) || (cmd == 0x1A) || (cmd == 0x1C) || (cmd == 0x1D) ) {
                        type = 5;
                    }
                } else if( SecondDeviceList.includes(BankMap.device) ) {
                    if( cmd < 0x10 ) {
                        type = 1;
                    } else if( (cmd == 0x12) || (cmd == 0x17) ) {
                        type = 2;
                    } else if( (cmd == 0x13) ) {
                        type = 3;
                    } else if( (cmd == 0x14) || (cmd == 0x15) ) {
                        type = 4;
                    } else if( (cmd == 0x1A) || (cmd == 0x1C) ) {
                        type = 5;
                    } else if( (cmd == 0x16) ) {
                        // data bit is core number, all chip
                        type = 6;
                    } else if( (cmd == 0x1B) || (cmd == 0x1D) ) {
                        // rect is channel, data is core number
                        type = 7;
                    }
                } else {
                }
                console.log(`Type = ${type}`);

                if( (type == 1) || (type == 3) || (type == 6) ) {
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx+3, y:sy+3, width:sw-6, height:sh-6, rx:10, ry:10,
                        fill:'transparent', stroke:'red', 'stroke-width':2,
                    }).appendTo(svg);

                    var data = BankMap.Banks[0].Data;
                    if( type == 3 ) {
                        var x = sx-5;
                        var y = sy+40;
                        for(var i=0; i<nChannel; i++) {
                            $(document.createElementNS(xmlns, 'text')).attr({
                                x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                            }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                            y += 18;
                        }
                    } else if( type == 6 ) {        // all device all core selected.
                        var x = sx+45;
                        var y = sy+20;
                        for(var i=0; i<8; i++) {
                            $(document.createElementNS(xmlns, 'text')).attr({
                                x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                            }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                            x += 40;
                        }
                    }
                } else {
                    if( BankMap.Banks[0].Chip == chip ) {
                        if( (type == 2) || (type == 4) ) {
                            $(document.createElementNS(xmlns, 'rect')).attr({
                                x:sx+3, y:sy+3, width:sw-6, height:sh-6, rx:10, ry:10,
                                fill:'transparent', stroke:'red', 'stroke-width':2,
                            }).appendTo(svg);

                            if( type == 2 ) {
                                var x = sx-5;
                                var y = sy+40;
                                var data = BankMap.Banks[0].Data;
                                for(var i=0; i<nChannel; i++) {
                                    $(document.createElementNS(xmlns, 'text')).attr({
                                        x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                                    }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                                    y += 18;
                                }
                            } else if( type == 4 ) {
                                var x = sx+45;
                                var y = sy+20;
                                var data = BankMap.Banks[0].Data;
                                for(var i=0; i<nCore; i++) {
                                    $(document.createElementNS(xmlns, 'text')).attr({
                                        x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                                    }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                                    x += 40;
                                }
                            }
                        } else if( (type == 5) || (type == 7) ) {
                            if( BankMap.Banks[0].Chip == chip ) {
                                var core = BankMap.Banks[0].Core;
                                var data = BankMap.Banks[0].Data;
                                if( type == 5 ) {
                                    var x = sx + 29 + (40 * core);
                                    var y = sy + 15;
                                    $(document.createElementNS(xmlns, 'rect')).attr({
                                        x:x, y:y, width:40, height:sh-18, rx:10, ry:10,
                                        fill:'transparent', stroke:'red', 'stroke-width':2,
                                    }).appendTo(svg);

                                    x = sx+25;
                                    y = sy+40;
                                    for(var i=0; i<nChannel; i++) {
                                        $(document.createElementNS(xmlns, 'text')).attr({
                                            x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                                        }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                                        y += 18;
                                    }
                                } else if( type == 7 ) {
                                    var x = sx + 29;
                                    var y = sy + 29 + (18 * core);
                                    $(document.createElementNS(xmlns, 'rect')).attr({
                                        x:x, y:y, width:sw-35, height:20, rx:10, ry:10,
                                        fill:'transparent', stroke:'red', 'stroke-width':2,
                                    }).appendTo(svg);

                                    x = sx+45;
                                    y = sy+20;
                                    for(var i=0; i<8; i++) {
                                        $(document.createElementNS(xmlns, 'text')).attr({
                                            x:x, y:y, 'fill':'red', 'font-weight':'bold', 'font-size':10,
                                        }).text((data & BitMask[i])?'1':'0').appendTo(svg);
                                        x += 40;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            function activeDevice2(svg, chip, sx, sy, sw, sh)
            {
                var type = 0;   // 1 : all chip, all core, all switch.
                                // 2 : all chip, selected core.
                                // 3 : all chip, selected channel.
                                // 4 : selected chip, all core.
                                // 5 : selected chip, all channel.
                                // 6 : selected chip, selected core.
                                // 7 : selected chip, selected channel.
                var Cmd = BankMap.Banks[0].Cmd;
                var nRow = BankMap.Banks[0].Devices[0].nChannel;      // nRow
                var nColumn = BankMap.Banks[0].Devices[0].nCore;         // nColumn
                var nChannel = BankMap.Banks[0].Devices[0].nChannel;
                var nCore = BankMap.Banks[0].Devices[0].nCore;
                var CmdType = (Cmd >> 3) & 0x7;
                var ChipSelect = BankMap.Banks[0].ChipSelect;

                console.log(`Type = ${CmdType}`);
                console.log(`ChipSelect = 0x${BankMap.Banks[0].ChipSelect.toString(16)}`);

                var x = sx + 35;
                var y = sy + 30;
                if( BankMap.Banks[0].ChipSelect & (1 << (7-chip)) ) {
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx+3, y:sy+3, width:sw-6, height:sh-6, rx:10, ry:10,
                        fill:'transparent', stroke:'yellow', 'stroke-width':2,
                    }).appendTo(svg);

                    if( CmdType == 0 ) {                // all switch.
                        var w = (nColumn * 40) - 12;
                        var h = (nRow * 18);
                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:x, y:y, width:w, height:h, rx:3, ry:3,
                            fill:'transparent', stroke:'red', 'stroke-width':2,
                        }).appendTo(svg);
                    } else if( CmdType == 1 ) {         // single switch.
                        var nSwitch = BankMap.Banks[0].Switches[0];
                        x += (parseInt(nSwitch / 10) * 40);
                        y += (parseInt(nSwitch % 10) * 18);
                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:x, y:y, width:28, height:18, rx:3, ry:3,
                            fill:'transparent', stroke:'red', 'stroke-width':2,
                        }).appendTo(svg);
                    } else if( CmdType == 2 ) {         // selected row all single switch.
                        var RowSelect = BankMap.Banks[0].RowSelect;
                        var w = (nColumn * 40) - 12;
                        var h = 18;
                        for(var row=0; row<nRow; row++) {
                            if( (RowSelect & (1 << ((nRow-1)-row))) == 0 ) continue;

                            $(document.createElementNS(xmlns, 'rect')).attr({
                                x:x, y:y, width:w, height:h, rx:3, ry:3,
                                fill:'transparent', stroke:'red', 'stroke-width':2,
                            }).appendTo(svg);
                            y += 18;
                        }
                    } else if( (CmdType == 3) || (CmdType == 5) ) {         // selected row & column single switch.
                        var RowSelect = BankMap.Banks[0].RowSelect;
                        var ColumnSelect = BankMap.Banks[0].ColumnSelect;
                        var w = 28;
                        var h = 18;
                        for(var row=0; row<nRow; row++) {
                            if( (RowSelect & (1 << ((nRow-1)-row))) == 0 ) continue;

                            for(var col=0; col<nColumn; col++) {
                                if( (ColumnSelect & (1 << ((nColumn-1)-col))) == 0 ) continue;
                                $(document.createElementNS(xmlns, 'rect')).attr({
                                    x:x+(col*40), y:y+(row*18), width:w, height:h, rx:3, ry:3,
                                    fill:'transparent', stroke:'red', 'stroke-width':2,
                                }).appendTo(svg);
                            }
                        }
                    } else if( CmdType == 4 ) {         // selected column all switch.
                        var ColumnSelect = BankMap.Banks[0].ColumnSelect;
                        var w = 28;
                        var h = (nRow * 18);
                        for(var col=0; col<nColumn; col++) {
                            if( (ColumnSelect & (1 << ((nColumn-1)-col))) == 0 ) continue;
                            $(document.createElementNS(xmlns, 'rect')).attr({
                                x:x+(col*40), y:y, width:w, height:h, rx:3, ry:3,
                                fill:'transparent', stroke:'red', 'stroke-width':2,
                            }).appendTo(svg);
                        }
                    } else if( CmdType == 6 ) {         // function command.
                    } else if( CmdType == 7 ) {         // multi switch switch.
                        var Switches = BankMap.Banks[0].Switches;
                        var w = 28;
                        var h = 18;
                        BankMap.Banks[0].Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Switches[parseInt(Channel.Number/8)] & (1 << (7 - (Channel.Number % 8))) ) {
                                var dx = (parseInt(Channel.Number / 10) * 40);
                                var dy = (parseInt(Channel.Number % 10) * 18);
                                $(document.createElementNS(xmlns, 'rect')).attr({
                                    x:x+dx, y:y+dy, width:w, height:h, rx:3, ry:3,
                                    fill:'transparent', stroke:'red', 'stroke-width':2,
                                }).appendTo(svg);
                            }
                        });
                    }
                }
            }

            function activeSP2003(svg, chip, sx, sy, sw, sh)
            {
                var Cmd = BankMap.Banks[0].Cmd;
                BankMap.Banks[0].Devices.forEach(function(Device, nDevice) {
//                    console.log(`Chip = ${Chip}, Cmd = 0x${Cmd.toString(16)}`);
                    if( Cmd == 0xA7 ) {
                        var Chip = BankMap.Banks[0].Chip;
                        var Ctrl = BankMap.Banks[0].Ctrl;

                        var x = (sx + 3) + (Chip * 40);
                        var y = (sy + 30) + ((Ctrl & 0x8) ? 54 : 0);
                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:x, y:y, width:40, height:54, rx:10, ry:10,
                            fill:'transparent', stroke:'yellow', 'stroke-width':2,
                        }).appendTo(svg);
                    } else {
                        $(document.createElementNS(xmlns, 'rect')).attr({
                            x:sx+3, y:sy+3, width:sw-6, height:sh-6, rx:10, ry:10,
                            fill:'transparent', stroke:'yellow', 'stroke-width':2,
                        }).appendTo(svg);
                    }
                });
            }

            function drawSwitch(svg, chip, sw, sx, sy) {    // ctrl : 0(OFF), 1(ON), 2(REJECT)
//                console.log(`chip = ${chip}, switch = ${sw}`);
                var channel = BankMap.Banks[0].Devices[chip].Switches[ sw ];
                var pov = (svg == svg1) ? 'OLD' : 'NEW';
                var color = 'Silver';
                var fillcolor = 'transparent';
                var w = 10
//                console.log(channel);


                if( channel.Valid ) {
                    color = (channel.Reject == 0) ? 'gray' : ((channel.OnOff == 0) ? 'blue' : 'red');
                    fillcolor = (channel.Reject == 0) ? 'gray' : ((channel.OnOff == 0) ? 'blue' : 'red');
                }

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M ${sx-5} ${sy} l ${w} 0 m 18 0 l ${w}, 0`,
                    stroke:(channel.Valid?'black':'Silver'), 'stroke-width':1,
                }).appendTo(svg);

                if( deviceName == 'SP2003' ) {
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:sx+(28/2), y:sy+(6), 'font-size':6, fill:color,
                        class:`${pov} CHIP${chip} SW${sw} centerAlign`,
                    }).text(channel.Valid ? `SW${parseInt(sw/3)}` : 'NC').appendTo(svg);
//                } else if( (deviceName == 'PS1120') || (deviceName == 'PS1060') || (deviceName == 'PS1030') ) {
//                    var n = BankMap.Banks[0].Devices[0].nSwitch - 1;
//                console.log(`nSwitch = ${n}`);
//                    $(document.createElementNS(xmlns, 'text')).attr({
//                        x:sx+(28/2), y:sy+(6), 'font-size':6, fill:color,
//                        class:`${pov} CHIP${chip} SW${n-sw} centerAlign`,
//                    }).text(channel.Valid ? `SW${n-sw}` : 'NC').appendTo(svg);
                } else {
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:sx+(28/2), y:sy+(6), 'font-size':6, fill:color,
                        class:`${pov} CHIP${chip} SW${sw} centerAlign`,
                    }).text(channel.Valid ? `SW${sw}` : 'NC').appendTo(svg);
                }
                $(document.createElementNS(xmlns, 'circle')).attr({
                    cx:sx+5+2, cy:sy, r:2, stroke:color, fill:fillcolor,
                    class:`${pov} CHIP${chip} SW SW${sw} DOT`,
                }).appendTo(svg);

                if( channel.Valid ) {
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${sx+5+4} ${sy-4} l ${w} 0`,
                        stroke:color, 'stroke-width':1, visibility:(channel.Reject==0)?'visible':'hidden',
                        class:`${pov} CHIP${chip} SW SW${sw} REJECT`,
                    }).appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${sx+5+4} ${sy} l ${w} 0`,
                        stroke:color, 'stroke-width':1, visibility:(channel.Reject==0)?'hidden':((channel.OnOff==1)?'visible':'hidden'),
                        class:`${pov} CHIP${chip} SW SW${sw} ON`,
                    }).appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${sx+5+4} ${sy} l ${w} -4`,
                        stroke:color, 'stroke-width':1, visibility:(channel.Reject==0)?'hidden':((channel.OnOff==0)?'visible':'hidden'),
                        class:`${pov} CHIP${chip} SW SW${sw} OFF`,
                    }).appendTo(svg);
                }

                $(document.createElementNS(xmlns, 'circle')).attr({
                    cx:sx+5+4+10+2, cy:sy, r:2, stroke:color, fill:fillcolor,
                    class:`${pov} CHIP${chip} SW SW${sw} DOT`,
                }).appendTo(svg);

                if( deviceName == 'STA-10' ) {
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx+3, y:sy-6, width:22, height:14,
                        fill:'transparent', stroke:color, 'stroke-width':1, 'stroke-opacity':0.5,
                        class:`${pov} CHIP${chip} SW${sw}`,
                        onclick:((svg == svg1) ? ((sw & 0x1) ? '':`toggleSwitch(${chip}, ${sw})`) : ''),
                        onmouseover:`showTooltip(event, ${chip}, ${sw})`, onmouseout:'hideTooltip(event)',
                    }).appendTo(svg);
                } else {
                    $(document.createElementNS(xmlns, 'rect')).attr({
                        x:sx+3, y:sy-6, width:22, height:14,
                        fill:'transparent', stroke:color, 'stroke-width':1, 'stroke-opacity':0.5,
                        class:`${pov} CHIP${chip} SW${sw}`,
                        onclick:((svg == svg1) ? (channel.Valid ? `toggleSwitch(${chip}, ${sw})` : '') : ''),
                        onmouseover:`showTooltip(event, ${chip}, ${sw})`, onmouseout:'hideTooltip(event)',
                    }).appendTo(svg);
                }
            }

            function drawLdo(svg, chip, sw, sx, sy) {    // ctrl : 0(OFF), 1(ON), 2(REJECT)
//                console.log(`chip = ${chip}, switch = ${sw}`);
                var channel = BankMap.Banks[0].Devices[chip].Switches[ sw ];
                var color;
                var pov = (svg == svg1) ? 'OLD' : 'NEW';
                var fillcolor = 'transparent';
                var w = 10
//                console.log(channel);

                if( channel.Valid ) {
                    if( channel.Reject == 0 ) {     // REJECT(gray)
                        color = 'gray';
                        fillcolor = 'gray';
                    } else {
                        color = (channel.OnOff == 0) ? 'blue' : 'red';
                        fillcolor = (channel.OnOff == 0) ? 'blue' : 'red';
                    }
                } else {
                    color = 'Silver';
                }

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M ${sx-5} ${sy} l ${w} 0 m 18 0 l ${w}, 0`,
                    stroke:(channel.Valid?'black':'Silver'), 'stroke-width':1,
                }).appendTo(svg);

                const n = [0, 0, 1, 0, 2, 3];
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:sx+(28/2), y:sy+6, 'font-size':6, fill:color,
                    class:`${pov} CHIP${chip} SW${sw} centerAlign`,
                }).text(channel.Valid ? `LDO${n[sw]}` : 'NC').appendTo(svg);
                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M ${sx+5} ${sy} h 4 v -4 l 10 4 h 4 m -4 0 l -10 4 v -4`,
                    stroke:color, 'stroke-width':1, fill:color, visibility:'visible',//(channel.Reject==0)?'visible':'hidden',
                    class:`${pov} CHIP${chip} SW${sw}`,
                }).appendTo(svg);

                $(document.createElementNS(xmlns, 'rect')).attr({
                    x:sx+3, y:sy-6, width:22, height:14,
                    fill:'transparent', stroke:color, 'stroke-width':1, 'stroke-opacity':0.5,
                    class:`${pov} CHIP${chip} SW${sw}`,
                    onclick:((svg == svg1) ? (channel.Valid ? `toggleSwitch(${chip}, ${sw})` : '') : ''),
                    onmouseover:`showTooltip(event, ${chip}, ${sw})`, onmouseout:'hideTooltip(event)',
                }).appendTo(svg);
            }


            function toggleCore(chip, core) {
                console.log(`toggleCore() : chip = ${chip}, core = ${core}`);
//                console.log(BankMap);

                if( deviceName == 'SP2003' ) {
                    var nChannel = BankMap.Banks[0].Devices[chip].nChannel;
                    BankMap.Banks[0].Devices[chip].Switches.forEach(function(channel, sw) {
                        if( channel.Valid == false ) return;        // MCC16

                        if( channel.Reject == 0 ) {  // when reject set.
                            channel.Reject = 1;  // reject clear
                            channel.OnOff = 0;   // switch off
                        } else {                    // when reject clear.
                            if( channel.OnOff == 1 ) {   // when switch on.
                                channel.Reject = 0;  // reject set.
                                channel.OnOff = 0;   // switch off
                            } else {                    // when switch off.
                                channel.Reject = 1;  // reject clear.
                                channel.OnOff = 1;   // switch on
                            }
                        }
//                        console.log(JSON.stringify(channel));

                        var color, select;
                        if( channel.Reject == 0 ) {
                            select = `.OLD.CHIP${chip}.SW${sw}.REJECT`;
                            color = 'gray';
                        } else {
                            if( channel.OnOff == 1 ) {
                                select = `.OLD.CHIP${chip}.SW${sw}.ON`;
                                color = 'red';
                            } else {
                                select = `.OLD.CHIP${chip}.SW${sw}.OFF`;
                                color = 'blue';
                            }
                        }
                        if( (sw == 1) || (sw == 2) || (sw == 4) || (sw == 5) ) {
                            $(`path.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                            $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                            $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);
                        } else {
//                        console.log(`color = ${color}`);
                            $(`path.OLD.CHIP${chip}.SW${sw}`).attr('visibility', 'hidden');
                            $(select).attr('visibility', 'visible').attr('stroke', color);
                            $(`circle.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                            $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                            $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);
                        }
                    });
                } else {
                    var nChannel = BankMap.Banks[0].Devices[chip].nChannel;
//                console.log(`nChannel = ${nChannel}`);
                    BankMap.Banks[0].Devices[chip].Switches.forEach(function(channel, sw) {
                        if( core != parseInt(channel.Number / nChannel) ) return;         // 'STA-1.01A' : 4, 'Other' : 8
                        if( channel.Valid == false ) return;        // MCC16

                        console.log(sw);
//                        console.log(JSON.stringify(channel));
                        if( channel.Reject == 0 ) {  // when reject set.
                            channel.Reject = 1;  // reject clear
                            channel.OnOff = 0;   // switch off
                        } else {                    // when reject clear.
                            if( channel.OnOff == 1 ) {   // when switch on.
                                channel.Reject = 0;  // reject set.
                                channel.OnOff = 0;   // switch off
                            } else {                    // when switch off.
                                channel.Reject = 1;  // reject clear.
                                channel.OnOff = 1;   // switch on
                            }
                        }
//                        console.log(JSON.stringify(channel));

                        var color, select;
                        if( channel.Reject == 0 ) {
                            select = `.OLD.CHIP${chip}.SW${sw}.REJECT`;
                            color = 'gray';
                        } else {
                            if( channel.OnOff == 1 ) {
                                select = `.OLD.CHIP${chip}.SW${sw}.ON`;
                                color = 'red';
                            } else {
                                select = `.OLD.CHIP${chip}.SW${sw}.OFF`;
                                color = 'blue';
                            }
                        }
                        if( (deviceName == 'SP2003') && ((sw == 1) || (sw == 2) || (sw == 4) || (sw == 5)) ) {
                            $(`path.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                            $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                            $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);
                        } else {
//                        console.log(`color = ${color}`);
                            $(`path.OLD.CHIP${chip}.SW${sw}`).attr('visibility', 'hidden');
                            $(select).attr('visibility', 'visible').attr('stroke', color);
                            $(`circle.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                            $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                            $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);
                        }
                    });
                }
            }

            function toggleSwitch(chip, sw) {
//                console.log(this);
                console.log(`toggleSwitch(): chip = ${chip}, switch = ${sw}`);
                var color, select;
                var channel = BankMap.Banks[0].Devices[chip].Switches[ sw ];
                console.log(JSON.stringify(channel));

                if( channel.Reject == 0 ) {
                    channel.Reject = 1;
                    channel.OnOff = 0;
                } else {
                    if( channel.OnOff == 1 ) {
                        channel.Reject = 0;
                        channel.OnOff = 0;
                    } else {
                        channel.OnOff = 1;
                        channel.Reject = 1;
                    }
                }

                if( (deviceName == 'SP2003') && ((sw != 0) && (sw != 3)) ) {
                    if( channel.Reject == 0 ) {
                        color = 'gray';
                    } else {
                        if( channel.OnOff == 1 ) {
                            color = 'red';
                        } else {
                            color = 'blue';
                        }
                    }
                    $(`path.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                    $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                    $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);

                    tooltip.innerHTML = `OnOff = ${channel.OnOff}, Reject = ${channel.Reject}, Level = ${channel.Level/1000}V`;
                } else {
                    $(`path.OLD.CHIP${chip}.SW${sw}`).attr('visibility', 'hidden');
                    if( channel.Reject == 0 ) {
                        select = `.OLD.CHIP${chip}.SW${sw}.REJECT`;
                        color = 'gray';
                    } else {
                        if( channel.OnOff == 1 ) {
                            select = `.OLD.CHIP${chip}.SW${sw}.ON`;
                            color = 'red';
                        } else {
                            select = `.OLD.CHIP${chip}.SW${sw}.OFF`;
                            color = 'blue';
                        }
                    }
                    $(select).attr('visibility', 'visible').attr('stroke', color);
                    $(`circle.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color).attr('fill', color);
                    $(`rect.OLD.CHIP${chip}.SW${sw}`).attr('stroke', color);
                    $(`text.OLD.CHIP${chip}.SW${sw}`).attr('fill', color);

                    tooltip.innerHTML = `OnOff = ${channel.OnOff}, Reject = ${channel.Reject}`;
                }

                console.log(JSON.stringify(channel));

//                console.log(BankMap);
            }

            function toHexString(arr) {
                return arr.map(function(val) {
                    return '0x' + val.toString(16).toUpperCase();
                }).join(' ');
            }

            function toHexByteString(bytes) {
                return bytes.map(function(byte) {
                    return '0x' + ('0' + (byte & 0xFF).toString(16).toUpperCase()).slice(-2);
                }).join(' ')
            }

            function pdf_view(deviceName, title) {
				let str;
				let filename;
				let page;

                if( deviceName == "STA-1.01A" ) {
                    filename = "DS_STA101A_V1.4.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 19;
                } else if( deviceName == 'STA-2' ) {
                    filename = "DS_STA2_V1.3.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 19;
                } else if( deviceName == 'STA-201' ) {
                    filename = "DS_STA201_V1.3.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 20;
                } else if( deviceName == 'STA-3B' ) {
                    filename = "DS_STA3B_V1.3.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 19;
                } else if( deviceName == 'STA-FX' ) {
                    filename = "DS_STAFX_V1.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 23;
                } else if( deviceName == 'STA-FX2' ) {
                    filename = "DS_STAFX2_V1 0.pdf";
                } else if( deviceName == 'STA-FX3' ) {
                    filename = ".pdf";
                } else if( deviceName == 'STA-10' ) {
                    filename = "DS_STA10_V0.5.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 55;
                } else if( deviceName == 'STA-20' ) {
                    filename = "DS_STA20_V0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 53;
                } else if( deviceName == 'STA-30' ) {
                    filename = "DS_STA30_V0.5.pdf";
                } else if( deviceName == 'STA-N' ) {
                    filename = "DS_STA-N_V1.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 56;
                } else if( deviceName == 'STA-X' ) {
                    filename = "DS_STA-X_128CH_V0.2.pdf";
                } else if( deviceName == 'STA-3X' ) {
                    filename = "DS_STA-3X_V0.1.pdf";
                } else if( deviceName == 'STA-XF' ) {
                    filename = "DS_STA-XF_V0.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 56;
                } else if( deviceName == 'HSS32' ) {
                    filename = ".pdf";
                } else if( deviceName == 'HSS64' ) {
                    filename = "DS_HSS64_V0.0.pdf";
                } else if( deviceName == 'MCC16' ) {
                    filename = "DS_MCC16_V0.3.pdf";
                } else if( deviceName == 'PS1120' ) {
                    filename = "PS1120_V0.3.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 62;
                } else if( deviceName == 'PS1060' ) {
                    filename = "PS1060_V0.0.pdf";
                } else if( deviceName == 'PS1030' ) {
                    filename = "PS1030_V0.0.pdf";
                } else if( deviceName == 'PS2064' ) {
                    filename = "PS2064_V0.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 64;
                } else if( deviceName == 'SP2003' ) {
                    filename = "DS_SP2003_V0.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 39;
                } else if( deviceName == "LPS1001" ) {
                    filename = "DS_LPS1001_V0.0.pdf";
					if( title == "Datasheet" ) page = 1;
					else if(title == "Feature") page = 2;
					else if(title == "Package") page = 13;
                }

                str = '<html><head><title>Command Analysis Result</title></head><body>';
                str += '<script src="http://code.jquery.com/jquery-1.11.0.min.js"><\/script>';
                str += '<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js"><\/script>';

				str += "<body>";
				str += "<div id='container'>";
				str += "</div>";
				str += "<script>";
				str += `var options = { title: 'STA-N Datasheet PDF', pdfOpenParams: {view:'Fit', page:${page}} };`;
				str += `PDFObject.embed('./datasheet/${filename}', '#container', options);`;
				str += "<\/script>";
				str += "<\/body>";
				str += "<\/html>";

                var opt = 'toolbar=no, menubar=no, location=no, status=no, width=680, height=800, left=600, top=500';
                var subWindow = window.open('', 'Data Sheet', opt, true);
                subWindow.document.write(str);
			}

            $('#package').on('click', function(e) {
				/*
                var width = 800;
                var height = 800;
                var top = 10;
                var left = 10;

                var url = 'Package.html';

                url += `?deviceName=${deviceName}`;
                var opt = `toolbar=no, menubar=no, location=no, status=no, target=_blank`;
                    opt += `, width=${width}, height=${height}, top=${top}, left=${left}`;

                window.open(url, `Package Window Open`, opt);
				*/
				pdf_view(deviceName, this.value);
            });

            $('#feature').on('click', function(e) {
				/*
                var width = 640;
                var height = 480;
                var top = 10;
                var left = 10;

                var url = 'Feature.html';

				if(deviceName == "STA-N") {
					width = 640;
					height = 640;
				} else if(deviceName == "STA-1.01A") {
					width = 640;
					height = 480;
				} else {
				}
                url += `?deviceName=${deviceName}`;
                var opt = `toolbar=no, menubar=no, location=no, status=no, target=_blank`;
                    opt += `, width=${width}, height=${height}, top=${top}, left=${left}`;
				console.log("deviceName = ", deviceName);

                window.open(url, `Feature Window Open`, opt);
				*/
				pdf_view(deviceName, this.value);
            });

            $('#datasheet').on('click', function(e) {
                var str;
                var filename;

				console.log("value = ", this.value);
				pdf_view(deviceName, this.value);
									/*
                if( deviceName == 'STA-101A' ) {
                    filename = "DS_STA101A_V1.4.pdf";
                } else if( deviceName == 'STA-2' ) {
                    filename = "DS_STA2_V1.3.pdf";
                } else if( deviceName == 'STA-201' ) {
                    filename = "DS_STA201_V1.3.pdf";
                } else if( deviceName == 'STA-3B' ) {
                    filename = "DS_STA3B_V1.3.pdf";
                } else if( deviceName == 'STA-FX' ) {
                    filename = "DS_STAFX_V1.0.pdf";
                } else if( deviceName == 'STA-FX2' ) {
                    filename = "DS_STAFX2_V1 0.pdf";
                } else if( deviceName == 'STA-FX3' ) {
                    filename = ".pdf";
                } else if( deviceName == 'STA-10' ) {
                    filename = "DS_STA10_V0.5.pdf";
                } else if( deviceName == 'STA-20' ) {
                    filename = "DS_STA20_V0.pdf";
                } else if( deviceName == 'STA-30' ) {
                    filename = "DS_STA30_V0.5.pdf";
                } else if( deviceName == 'STA-N' ) {
                    filename = "DS_STA-N_V1.0.pdf";
                } else if( deviceName == 'STA-X' ) {
                    filename = "DS_STA-X_128CH_V0.2.pdf";
                } else if( deviceName == 'STA-3X' ) {
                    filename = "DS_STA-3X_V0.1.pdf";
                } else if( deviceName == 'STA-XF' ) {
                    filename = "DS_STA-XF_V0.0.pdf";
                } else if( deviceName == 'HSS32' ) {
                    filename = ".pdf";
                } else if( deviceName == 'HSS64' ) {
                    filename = "DS_HSS64_V0.0.pdf";
                } else if( deviceName == 'MCC16' ) {
                    filename = "DS_MCC16_V0.3.pdf";
                } else if( deviceName == 'PS1120' ) {
                    filename = "PS1120_V0.3.pdf";
                } else if( deviceName == 'PS1060' ) {
                    filename = "PS1060_V0.0.pdf";
                } else if( deviceName == 'PS1030' ) {
                    filename = "PS1030_V0.0.pdf";
                } else if( deviceName == 'SP2003' ) {
                    filename = "DS_SP2003_V0.0.pdf";
                }

                str = '<html><head><title>Command Analysis Result</title></head><body>';
                str += '<script src="http://code.jquery.com/jquery-1.11.0.min.js"><\/script>';
                str += '<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js"><\/script>';

				str += "<body>";
				str += "<div id='container'>";
				str += "</div>";
				str += "<script>";
				str += "var options = { title: 'STA-N Datasheet PDF', pdfOpenParams: {view:'Fit', page:'20'} };";
				str += `PDFObject.embed('./datasheet/${filename}', '#container', options);`;
				str += "<\/script>";
				str += "<\/body>";
				str += "<\/html>";
				   */

//                str += "<body><div id='container'></div><script>PDFObject.embed('./datasheet/";
//                str += `${filename}`;
//                str += "', '#container');<\/script>";
//                str += "</body></html>";

                var opt = 'toolbar=no, menubar=no, location=no, status=no, width=680, height=800, left=600, top=500';
                var subWindow = window.open('', 'Data Sheet', opt, true);
                subWindow.document.write(str);
            });

            $('#overview').on('click', function(e) {
                var width = 820;
                var height = 720;
                var top = 10;
                var left = 10;

                var url = 'Overview.html';
				console.log("devideName = ", deviceName);

                if( FirstDeviceList.includes(deviceName) ) {
                    url += `?Type=OldSTA`;
                	url += `&deviceName=${deviceName}`;
                    width = 1140;
                    height = 700;
                } else if( SecondDeviceList.includes(deviceName) ) {
                    url += `?Type=NewSTA`;
                	url += `&deviceName=${deviceName}`;
                    width = 820;
                    height = 700;
                } else if( ThirdDeviceList.includes(deviceName) ) {
                    url += `?Type=PS`;
                	url += `&deviceName=${deviceName}`;
                    width = 820;
                    height = 700;
                }
                var opt = `toolbar=no, menubar=no, location=no, status=no, target=_blank`;
                    opt += `, width=${width}, height=${height}, top=${top}, left=${left}`;

                window.open(url, `Overview Window Open`, opt);
            });

            $('#id-device').on('change', function(e) {
                var $this = $(this);
//                console.log(e);
//                console.log(`frame click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
                deviceName = event.target.value;
                var color = $this.find('option:selected').css('background-color');
                $this.css({'background-color':color});

                console.log(`device Name : ${deviceName}`);

                createWindow(deviceName);

                document.getElementById('svgContainer2').innerHTML = ""; // 기존에 생성된 Wafer Map을 제거한다.
                document.getElementById('svgContainer3').innerHTML = ""; // 기존에 생성된 Wafer Map을 제거한다.
            });

            $('#oldCommand').on('change', function(e) {
                console.log(`frame click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
//                $this.css({'background-color':$this.find('option:selected').css('background-color')});
                changeCommmand(deviceName, parseInt(e.target.value));
            });

            $('#newCommand').on('change', function(e) {
                console.log(`frame click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
//                $this.css({'background-color':$this.find('option:selected').css('background-color')});
                changeCommmand(deviceName, parseInt(e.target.value));
            });

            $('#PSxxxxCommand').on('change', function(e) {
                console.log(`frame click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
//                $this.css({'background-color':$this.find('option:selected').css('background-color')});
                changeCommmand(deviceName, parseInt(e.target.value));
            });

            $('#Function').on('change', function(e) {
                console.log(`Function click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
                var func = parseInt(e.target.value);
                $('.Parameter').css('display', 'none');
                $('#FunctionField').css('display', 'inline-block');
                if( func == 0x1 ) {
                    $('#GroupField').css('display', 'inline-block');
                } else if( func == 0x7 ) {
                    $('#MaskField').css('display', 'inline-block');
                }
            });

            $('#SP2003Command').on('change', function(e) {
                console.log(`SP2003Command click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
                var cmd = parseInt(e.target.value);

                changeCommmand(deviceName, parseInt(e.target.value));
            });

/*
            $("[name='LogicCommand']").on('change', function(e) {
                console.log(`name select event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
                var $this = $(this);
                var color = $this.find('option:selected').css('background-color');
                $this.css({'background-color':color});
            });
*/

            $('#MCC16').on('change', function(e) {
                var $this = $(this);
                var color = $this.find('option:selected').css('background-color');
                console.log(color);
                $this.css({'background-color':color});
            });

            $('#send').on('click', function(e) {
//                console.log(e);
//                console.log(`frame click event : ${e.type}, ${e.target.value}, ${this.checked}\n`);
                console.log(`deviceName = ${deviceName}`);
                var cmd;

                var chip = parseInt($('#ChipNum').val());
                var core = parseInt($('#CoreNum').val());
                var data = parseInt($('#DataNum').val());
                if( first == 0 ) {
                    drawBank(0);
                }
                console.log(`chip = ${chip}, core = ${core}, data = 0x${data.toString(16)}`);

                if( ThirdDeviceList.includes(deviceName) ) {
                    if( deviceName == 'SP2003' ) {
                        var ctrl;
                        var bytes = [];

                        cmd = parseInt($('#SP2003Command').val());
                        bytes.push(cmd);
                        if( (cmd == 0xA0) || (cmd == 0xA1) || (cmd == 0xA2) || (cmd == 0xA3) ) {
                        } else if( cmd == 0xA4 ) {
                            ctrl = parseInt($('#Ctrl1Value').val());
                            bytes.push(ctrl << 4);
                        } else if( cmd == 0xA5 ) {
                            var chip = parseInt($('#ChipNumber').val());
                            var ctrl = parseInt($('#Ctrl1Value').val());
                            bytes.push((chip << 4) | ctrl);
                        } else if( cmd == 0xA6 ) {
                            var chip = parseInt($('#ChipNumber').val());
                            var ctrl = parseInt($('#Ctrl2Value').val());
                            bytes.push((chip << 4) | ctrl);
                            ctrl = parseInt($('#Ctrl3Value').val());
                            bytes.push(ctrl << 4);
                        } else if( cmd == 0xA7 ) {
                            var chip = parseInt($('#ChipNumber').val());
                            var ctrl = parseInt($('#Ctrl4Value').val());
                            bytes.push((chip << 4) | ctrl);
                        } else if( cmd == 0xA8 ) {
                            var select = parseInt($('#ChipSelect16').val());
                            bytes.push(select >> 8);
                            bytes.push(select & 0xFF);
                            var ctrl = parseInt($('#Ctrl1Value').val());
                            bytes.push(ctrl << 4);
                        } else if( cmd == 0xA9 ) {
                            var level = $('#LevelValue').val();
                            bytes.push(level >> 4);
                            bytes.push((level << 4) & 0xF0);
                        } else if( (cmd == 0xAD) || (cmd == 0xAE) ) {
                            if( $("input:radio[name='EnableDisable']:radio[value='Enable']").prop('checked') ) {
                                bytes.push(0x80);
                            } else if( $("input:radio[name='EnableDisable']:radio[value='Disable']").prop('checked') ) {
                                bytes.push(0x00);
                            }
                        } else if( cmd == 0xAF ) {
                            var mask = $('#MaskSelect').val();
                            bytes.push((mask >> 8) & 0xFF);
                            bytes.push(mask & 0xFF);
                        }
                        bytes.push(0x0);        // operate cycle.
                        bytes.push(0x0);        // operate cycle.
                        bytes.push(0x0);        // shift cycle.
                        bytes.push(0x0);        // shift cycle.
                        run_SP2003Command(bytes);
                        drawCommand2(bytes);
                    } else {
                        var bytes = [];

                        bytes.push(0xAA);
                        cmd = parseInt($('#PSxxxxCommand').val());
                        var opcode;
                        if( (cmd & 0x7) == 6 ) {
                            opcode = parseInt($('#Function').val());
                        } else {
                            opcode = parseInt($('#Opcode').val());
                        }
                        bytes.push((cmd << 3) | opcode);

                        if( cmd & 0x08 ) {
                            chip = parseInt($('#ChipSelect').val());
                            bytes.push(chip);
                        }
                        cmd = cmd & 0x7;

                                   console.log(`cmd = ${cmd}`);
                        if( cmd == 0 ) {
                        } else if( cmd == 1 ) {
                            var sw = parseInt($('#NumberSelect').val());
                            bytes.push(sw);
                        } else if( cmd == 2 ) {
                            var rows = parseInt($('#RowSelect').val());
                                   console.log(`rows = 0x${rows.toString(16)}`);
                            bytes.push(rows>>2);
                            bytes.push(rows<<6);
                        } else if( cmd == 3 ) {
                            var rows = parseInt($('#RowSelect').val());
                            var columns = parseInt($('#ColumnSelect').val());
                            bytes.push(rows>>2);
                            bytes.push((rows<<6) | (columns >> 6));
                            bytes.push(columns << 2);
                        } else if( cmd == 4 ) {
                            var columns = parseInt($('#ColumnSelect').val());
                            bytes.push(columns >> 4);
                            bytes.push(columns << 4);
                        } else if( cmd == 5 ) {
                            var rows = parseInt($('#RowSelect').val());
                            var columns = parseInt($('#ColumnSelect').val());
                            bytes.push(columns >> 4);
                            bytes.push((columns << 4) | (rows >> 6));
                            bytes.push(rows << 2);
                        } else if( cmd == 6 ) {
                            var func = parseInt($('#Function').val());
                            if( func == 0x1 ) {
                                bytes.push((parseInt($('#GroupNumber').val())<<5));
                            } else if( func == 0x7 ) {
                                bytes.push(parseInt($('#MaskSelect').val()));
                            }
                        } else if( cmd == 7 ) {
//                        console.log( $('#SwitchSelect').val() );
                            var switches = $('#SwitchSelect').val().split(/[\s,]+/).map(Number);
                            console.log(switches);
//                        UnicodeEncoding encoding = new UnicodeEncoding();
//                        byte[] switches = encoding.GetBytes( $('#SwitchSelect').val() );
                            for(var i=0; i<(BankMap.Banks[0].Devices[0].nSwitch / 8); i++) {
                                bytes.push(switches[i]);
                            }
                        }
                        bytes.push(0x0);        // op
                        bytes.push(0x0);        // shift
                        console.log( toHexByteString(bytes) );
                        run_PSxxxxCommand(bytes);
                        drawCommand2(bytes);
                    }
                } else {
                    if( FirstDeviceList.includes(deviceName) ) {
                        cmd = parseInt($('#oldCommand').val());
                        console.log(`device = ${deviceName}, cmd = 0x${cmd.toString(16)}`);
                        run_STACommand(chip, core, cmd, data);
                    } else if( SecondDeviceList.includes(deviceName) ) {
                        cmd = parseInt($('#newCommand').val());
                        console.log(`device = ${deviceName}, cmd = 0x${cmd.toString(16)}`);
                        run_newSTACommand(chip, core, cmd, data);
                    }
                    drawCommand(chip, core, cmd, data);
                }

                drawBank(1);

                first = 0;
            });

            function changeDevice(name) {
                var cmd;

                $('.Command').css('display', 'none');       // All 'Command' class display off.
                $('div.labeltext').css('display', 'none');      // 

                if( FirstDeviceList.includes(name) ) {                  // first generate Chips.
                    $('#STACommand').css('display', 'inline-block');
                    $('#newCommand').css('display', 'none');
                    $('#oldCommand').css('display', 'inline-block');
                    cmd = parseInt($('#oldCommand').val());
                } else if( SecondDeviceList.includes(name) ) {          // second generate Chips.
                    $('#STACommand').css('display', 'inline-block');
                    $('#oldCommand').css('display', 'none');
                    $('#newCommand').css('display', 'inline-block');
                    cmd = parseInt($('#newCommand').val());
                } else if( ThirdDeviceList.includes(name) ) {           // third generate Chips.
                    $('#STACommand').css('display', 'none');
                    if( name == 'SP2003' ) {
                        $('#SP2003CmdField').css('display', 'inline-block');
                        cmd = parseInt($('#SP2003Command').val());
                    } else {
                        $('#PSxxxxCmdField').css('display', 'inline-block');
                        cmd = parseInt($('#PSxxxxCommand').val());
                    }
                } else {
                    console.log('unknown device.');
                    cmd = 0;
                }
                changeCommmand(name, cmd);
            }

            function changeCommmand(name, cmd) {
                console.log(`${name} Command = 0x${cmd.toString(16)}`);
                $('.Parameter').css('display', 'none');
                if( FirstDeviceList.includes(name) ) {                  // first generate Chips.
					console.log("first device list");
                    if( (cmd == 0x10) || (cmd == 0x11) || (cmd == 0x12) || (cmd == 0x14) ) {    // selected chip, all core, 8-bit data.
                        $('#ChipID').css('display', 'inline-block');
                        $('#ChipNum').val('1');
                        $('#WData').css('display', 'inline-block');
                        $('#DataNum').val('0x5A');
                    } else if( cmd == 0x13 ) {                  // all chip, all core, 8-bit data.
                        $('#WData').css('display', 'inline-block');
                        $('#DataNum').val('0x5A');
                    } else if( (cmd == 0x18) || (cmd == 0x19) || (cmd == 0x1A) || (cmd == 0x1C) || (cmd == 0x1D) ) {	// selected chip, selected core, 8-bit data.
                        $('#ChipID').css('display', 'inline-block');
                        $('#ChipNum').val('1');
                        $('#CoreID').css('display', 'inline-block');
                        $('#CoreNum').val('1');
                        if( cmd != 0x1D ) {								// all switch
                            $('#WData').css('display', 'inline-block');
                            $('#DataNum').val('0x5A');
                        }
                    }
                } else if( SecondDeviceList.includes(name) ) {          // second generate Chips.
                    if( cmd < 0x10 ) return;

                    if( (cmd == 0x11) || (cmd == 0x12) || (cmd == 0x14) || (cmd == 0x15) || (cmd == 0x17) || (cmd == 0x18) || (cmd == 0x19) ) {
                        $('#ChipID').css('display', 'inline-block');
                        $('#ChipNum').val('1');
//                    } else if( (cmd == 0x13) || (cmd == 0x16) ) {
                    } else if( (cmd == 0x1A) || (cmd == 0x1B) || (cmd == 0x1C) || (cmd == 0x1D) ) {
                        $('#ChipID').css('display', 'inline-block');
                        $('#ChipNum').val('1');
                        $('#CoreID').css('display', 'inline-block');
                        $('#CoreNum').val('1');
                    }
                    $('#WData').css('display', 'inline-block');
                    $('#DataNum').val('0x3A');

                    $('#DataNum').val('0xA5');
                } else if( ThirdDeviceList.includes(name) ) {           // third generate Chips.
                    if( name == 'SP2003' ) {
                        if( (cmd == 0xA0) || (cmd == 0xA1) || (cmd == 0xA2) || (cmd == 0xA3) ) {
                        } else if( cmd == 0xA4 ) {
                            $('#Ctrl1Field').css('display', 'inline-block');
                        } else if( cmd == 0xA5 ) {
                            $('#ChipNumberField').css('display', 'inline-block');
                            $('#Ctrl1Field').css('display', 'inline-block');
                        } else if( cmd == 0xA6 ) {
                            $('#ChipNumberField').css('display', 'inline-block');
                            $('#Ctrl2Field').css('display', 'inline-block');
                        } else if( cmd == 0xA7 ) {
                            $('#ChipNumberField').css('display', 'inline-block');
                            $('#Ctrl4Field').css('display', 'inline-block');
                        } else if( cmd == 0xA8 ) {
                            $('#ChipSelectField').css('display', 'inline-block');
                            $('#Ctrl1Field').css('display', 'inline-block');
                        } else if( cmd == 0xA9 ) {
                            $('#LevelField').css('display', 'inline-block');
                        } else if( cmd == 0xAD ) {
                            $('#CtrlField').css('display', 'inline-block');
                            if( BankMap.Banks[0].Devices[0].TrimSFR == true ) {
                                $("input:radio[name='EnableDisable']:radio[value='Disable']").prop('checked', true);
                            } else {
                                $("input:radio[name='EnableDisable']:radio[value='Enable']").prop('checked', true);
                            }
                        } else if( cmd == 0xAE ) {
                            $('#CtrlField').css('display', 'inline-block');
                            if( BankMap.Banks[0].Devices[0].ChannelSFR == true ) {
                                $("input:radio[name='EnableDisable']:radio[value='Disable']").prop('checked', true);
                            } else {
                                $("input:radio[name='EnableDisable']:radio[value='Enable']").prop('checked', true);
                            }
                        } else if( cmd == 0xAF ) {
                            $('#MaskField').css('display', 'inline-block');
                            $('#MaskSelect').val('0xFFFF');
                        }
                    } else {
                        console.log(`cmd = 0x${cmd.toString(16)}`);
                        if( cmd & 0x08 ) {
                            $('#ChipField').css('display', 'inline-block');
                        }
                        var Type = cmd & 0x7;

                        $('#FunctionField').css('display', 'none');
                        $('#OpcodeField').css('display', 'inline-block');
//                            $('#NumberSelect').attr('max', BankMap.Banks[0].Devices[0].nSwitch-1).val(BankMap.Banks[0].Devices[0].nSwitch-1);
                        $('#NumberSelect').attr('max', BankMap.Banks[0].Devices[0].nSwitch-1).val(0);
                        $('#RowSelect').val(`0x${(1 << (BankMap.Banks[0].Devices[0].nChannel-1)).toString(16)}`);
                        $('#ColumnSelect').val(`0x${(1 << (BankMap.Banks[0].Devices[0].nCore-1)).toString(16)}`);
                        if( Type == 0 ) {
                        } else if( Type == 1 ) {
                            $('#NumberField').css('display', 'inline-block');
                        } else if( Type == 2 ) {
                            $('#RowField').css('display', 'inline-block');
                        } else if( Type == 3 ) {
                            $('#RowField').css('display', 'inline-block');
                            $('#ColumnField').css('display', 'inline-block');
                        } else if( Type == 4 ) {
                            $('#ColumnField').css('display', 'inline-block');
                        } else if( Type == 5 ) {
                            $('#RowField').css('display', 'inline-block');
                            $('#ColumnField').css('display', 'inline-block');
                        } else if( Type == 6 ) {
                            $('#OpcodeField').css('display', 'none');
                            $('#FunctionField').css('display', 'inline-block');
                            var func = parseInt($('#Function').val());
                            if( func == 0x1 ) {
                                $('#GroupField').css('display', 'inline-block');
                            } else if( func == 0x7 ) {
                                $('#MaskField').css('display', 'inline-block');
                                $('#MaskSelect').val('0xFF');
                            }
                        } else if( Type == 7 ) {
                            $('#SwitchField').css('display', 'inline-block');
                            var str = '';
                            for(var i=0; i<Math.ceil(BankMap.Banks[0].Devices[0].nSwitch / 8); i++) {
                                str += `0x${(i+1).toString(16)} `;
                            }
                            $('#SwitchSelect').val(str);
                        }
                    }
                }
            }

            function run_newSTACommand(chip, core, cmd, data) {
                console.log(BankMap);
                console.log(`chip = ${chip}, core = ${core}, cmd = ${cmd}, data = ${data}`);
                BankMap.Banks.forEach(function(Bank, nBank) {
                    Bank.Chip = chip;
                    Bank.Core = core;
                    Bank.Cmd = cmd;
                    Bank.Data = data;
                });
                if( (cmd == 0x2) || (cmd == 0x3) || (cmd == 0x4) || (cmd == 0x5) ) {         // RESET_ALL
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                if( cmd == 0x2 ) {              // RESET_ALL
                                    // All OFF & Reject Clear.
                                    Channel.Reject = 1;
                                    Channel.OnOff = 0;
                                } else if( cmd == 0x3 ) {       // CLEAR_ALL
                                    // All OFF.
                                    Channel.OnOff = 0;
                                } else if( cmd == 0x4 ) {       // ENABLE_ALL
                                    // All ON.
                                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                                } else if( cmd == 0x5 ) {       // INITIAL_ALL
                                    // All ON & Reject clear.
                                    Channel.Reject = 1;
                                    Channel.OnOff = 1;
                                }
                            });
                        });
                    });
                } else if( (cmd == 0xB) || (cmd == 0xC) || (cmd == 0xD) ) {         // EN1_WCON, EN2_WCON, DIS_WCON
                    // second write enable to control register.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( cmd == 0xB ) {
                                Device.WriteEnable = 0;
                            } else if( cmd == 0xB ) {
                                Device.WriteEnable = 1;
                            } else if( cmd == 0xC ) {
                                Device.WriteEnable = (Device.WriteEnable == 1) ? 2 : 0;
                            }
                        });
                    });
                } else if( (cmd == 0x11) || (cmd == 0x18) || (cmd == 0x19) ) {      // WR_GCON, WR_CLCON, WR_TSDCON
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        var Device = Bank.Devices[chip];
                        if( Device.WriteEnable == 2 ) {
                            if( cmd == 0x11 ) {
                                Device.GCON = data;
                                console.log(`MCC16[${Device.ID}] : GCON = ${Device.GCON}`);
                            } else if( cmd == 0x18 ) {
                                Device.CLCON = data;
                                console.log(`MCC16[${Device.ID}] : CLCON = ${Device.CLCON}`);
                            } else if( cmd == 0x19 ) {
                                Device.TSDCON = data;
                                console.log(`MCC16[${Device.ID}] : TSDCON = ${Device.TSDCON}`);
                            }
                        } else {
                            Device.WriteEnable = 0;
                        }
                    });
                } else if( (cmd == 0x12) || (cmd == 0x15) ) {      // DIRECT_CHP_COR, DIRECT_CHP_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            var pos = (cmd == 0x12) ? (Channel.Number % 8) : parseInt(Channel.Number / 8);

                            if( data & BitMask[pos] ) {    // core number check
                                if( Channel.Reject == 1 ) Channel.OnOff = 1;
                            } else {
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( (cmd == 0x13) || (cmd == 0x16) ) {      // DIRECT_BNK_COR, DIRECT_BNK_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                var pos = (cmd == 0x13) ? (Channel.Number % 8) : parseInt(Channel.Number / 8);
                                if( data & BitMask[pos] ) {
                                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            });
                        });
                    });
                } else if( (cmd == 0x14) || (cmd == 0x17) ) {      // REJECT_CHP_COR, REJECT_CHP_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            var pos = (cmd == 0x14) ? parseInt(Channel.Number / 8) : (Channel.Number % 8);
                            if( (data & BitMask[pos]) == 0 ) { // core number check.
                                Channel.Reject = 0;
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( (cmd == 0x1A) || (cmd == 0x1B) ) {      // DIRECT_COR_SW, DIRECT_CHN_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            var Tcore = (cmd == 0x1A) ? parseInt(Channel.Number / 8) : (Channel.Number % 8);
                            if( core == Tcore ) {        // core number check.
                                var pos = (cmd == 0x1A) ? (Channel.Number % 8) : parseInt(Channel.Number / 8);
                                if( data & BitMask[pos] ) {
                                    if( Channel.Reject == 1) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                } else if( (cmd == 0x1C) || (cmd == 0x1D) ) {      // REJECT_COR_SW, REJECT_CHN_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            var Tcore = (cmd == 0x1C) ? parseInt(Channel.Number / 8) : (Channel.Number % 8);
                            if( core == Tcore ) {        // core number check.
                                var pos = (cmd == 0x1C) ? (Channel.Number % 8) : parseInt(Channel.Number / 8);
                                if( (data & BitMask[pos]) == 0 ) {
                                    Channel.Reject = 0;
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                /*
                } else if( cmd == 0x12 ) {      // DIRECT_CHP_COR
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( data & BitMask[Channel.Number % 8] ) {    // core number check
                                if( Channel.Reject == 1 ) Channel.OnOff = 1;
                            } else {
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( cmd == 0x13 ) {      // DIRECT_BNK_COR
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                if( data & BitMask[Channel.Number % 8] ) {    // core number check
                                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            });
                        });
                    });
                } else if( cmd == 0x14 ) {      // REJECT_CHP_COR
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( (data & BitMask[parseInt(Channel.Number / 8)]) == 0 ) { // core number check.
                                Channel.Reject = 0;
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( cmd == 0x15 ) {      // DIRECT_CHP_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( data & BitMask[parseInt(Channel.Number / 8)] ) {          // channel number check
                                if( Channel.Reject == 1 ) Channel.OnOff = 1;
                            } else {
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( cmd == 0x16 ) {      // DIRECT_BNK_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                if( data & BitMask[parseInt(Channel.Number / 8)] ) {          // channel number check.
                                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            });
                        });
                    });
                } else if( cmd == 0x17 ) {      // REJECT_CHP_CHN
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( (data & BitMask[Channel.Number % 8]) == 0 ) {   // channel number check.
                                Channel.Reject = 0;
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( cmd == 0x1A ) {      // DIRECT_COR_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / 8) ) {        // core number check.
                                if( data & BitMask[Channel.Number % 8] ) {
                                    if( Channel.Reject == 1) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1B ) {      // DIRECT_CHN_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == (Channel.Number % 8) ) {        // channel number check.
                                if( data & BitMask[parseInt(Channel.Number / 8)] ) {
                                    if( Channel.Reject == 1) Channel.OnOff = 1;
                                } else {
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1C ) {      // REJECT_COR_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / 8) ) {        // core number check.
                                if( (data & BitMask[Channel.Number % 8]) == 0 ) {
                                    Channel.Reject = 0;
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1D ) {      // REJECT_CHN_SW
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == (Channel.Number % 8) ) {        // channel number check.
                                if( (data & BitMask[parseInt(Channel.Number / 8)]) == 0 ) {
                                    Channel.Reject = 0;
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                */
                }
                console.log(BankMap);
            }

            function run_SP2003Command(bytes) {
                var idx = 0;
                console.log( toHexByteString(bytes) );

                var Cmd = bytes[idx++];

                BankMap.Banks.forEach(function(Bank, nBank) {
                    Bank.Cmd = Cmd;           // 0 ~ 0xFF
                    Bank.ChipSelect = 0xFFFF;    // 0x1 ~ 0xFFFF
                    Bank.RowSelect = 0;     // 0x1 ~ 0x3FF (@PS1120, 10분기)
                    Bank.ColumnSelect = 0;  // 0x1 ~ 0xFFF (@PS1120, 10분기)
                    Bank.Data = 0;
                    Bank.Switches = [];     // 0 ~ 0xFF

                    if( Cmd == 0xA0 ) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                Channel.OnOff = 0;
                                Channel.Reject = 1;
                            });
                        });
                    } else if( Cmd == 0xA1 ) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                Channel.OnOff = 1;
                                Channel.Reject = 1;
                            });
                        });
                    } else if( Cmd == 0xA2 ) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;
                            Device.CL = true;
                        });
                    } else if( Cmd == 0xA3 ) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;
                            Device.CL = false;
                        });
                    } else if( Cmd == 0xA4 ) {
                        var ctrl = bytes[idx] >> 4;
                        console.log(`ctrl-1 = ${ctrl}`);
                        Bank.Ctrl = ctrl;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Reject == 0 ) return;
                                Channel.OnOff = ( ctrl & (1 << (2 - (Channel.Number % 3))) ) ? 1 : 0;
                            });
                        });
                    } else if( Cmd == 0xA5 ) {
                        var chip = bytes[idx] >> 4;
                        var ctrl = bytes[idx] & 0xF;
                        console.log(`chip = ${chip}, ctrl-1 = ${ctrl}`);
                        Bank.Chip = chip;
                        Bank.Ctrl = ctrl;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( Device.ID == chip ) {
                                Device.Switches.forEach(function(Channel, nChannel) {
                                    if( Channel.Reject == 0 ) return;
                                    Channel.OnOff = ( ctrl & (1 << (2 - (Channel.Number % 3))) ) ? 1 : 0;
                                });
                            } else {
                                Device.Switches.forEach(function(Channel, nChannel) {
                                    if( Channel.Reject == 0 ) return;
                                    Channel.OnOff = 0;
                                });
                            }
                        });
                    } else if( Cmd == 0xA6 ) {
                        const SP2003_Channel_Pos = [6, 5, 4, 2, 1, 0];
                        var chip = bytes[idx] >> 4;
                        var ctrl = ((bytes[idx] & 0xF) << 4) | ((bytes[idx+1] & 0xF0) >> 4);
                        Bank.Chip = chip;
                        Bank.Ctrl = ctrl;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( Device.ID == chip ) {
                                Device.Switches.forEach(function(Channel, nChannel) {
                                    if( Channel.Reject == 0 ) return;
                                    Channel.OnOff = ( ctrl & (1 << SP2003_Channel_Pos[Channel.Number]) ) ? 1 : 0;
                                });
                            } else {
                                Device.Switches.forEach(function(Channel, nChannel) {
                                    if( Channel.Reject == 0 ) return;
                                    Channel.OnOff = 0;
                                });
                            }
                        });
                    } else if( Cmd == 0xA7 ) {
                        var chip = bytes[idx] >> 4;
                        var ctrl = (bytes[idx] & 0xF);
                        Bank.Chip = chip;
                        Bank.Ctrl = ctrl;
                        console.log(`Bank.Chip = ${Bank.Chip}`);
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( Device.ID != chip ) return;
                            if( (ctrl & 0x08) == 0 ) {      // 1'st PMIC
                                for(var i=0; i<3; i++) {
                                    if( ctrl & (1<<(2-i)) ) {       // reject
                                        Device.Switches[i].Reject = 0;
                                    }
                                }
                            } else {                        // 2'nd PMIC
                                for(var i=0; i<3; i++) {
                                    if( ctrl & (1<<(2-i)) ) {       // reject
                                        Device.Switches[i+3].Reject = 0;
                                    }
                                }
                            }
                        });
                    } else if( Cmd == 0xA8 ) {
                        var select = (bytes[idx] << 8) | bytes[idx+1];
                        var ctrl = (bytes[idx+2] & 0xF0) >> 4;
                        Bank.ChipSelect = select;
                        Bank.Ctrl = ctrl;
                        console.log(`select = 0x${select.toString(16)}, ctrl = 0x${ctrl.toString(16)}`);
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (select & (1 << (15 - Device.ID))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Reject == 0 ) return;
                                Channel.OnOff = ( ctrl & (1 << (2 - (Channel.Number % 3))) ) ? 1 : 0;
                            });
                        });
                    } else if( Cmd == 0xA9 ) {
                        var level = (bytes[idx] << 4) | (bytes[idx+1] >> 4);
                        Bank.Data = level;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( (nChannel == 0) || (nChannel == 3) ) return;
                                Channel.Level = level;
                            });
                        });
                    } else if( Cmd == 0xAD ) {
                        var flag = bytes[idx] >> 4;
                        Bank.Ctrl = flag;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            Device.TrimSFR = (flag == 0x8) ? true : false;
                        });
                    } else if( Cmd == 0xAE ) {
                        var flag = bytes[idx] >> 4;
                        Bank.Ctrl = flag;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            Device.ChannelSFR = (flag == 0x8) ? true : false;
                        });
                    } else if( Cmd == 0xAF ) {
                        var mask = (bytes[idx] << 8) | bytes[idx+1];
                        Bank.ChipSelect = mask;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) {
                                if( mask & (1 << (15-nDevice)) ) {
                                    Device.ID = nDevice;
                                    mask &= ~(1 << (15-nDevice));
                                }
                            }
                        });
                    }
                });
                console.log(BankMap);
            }

            function run_PSxxxxCommand(bytes) {
                var idx = 0;
                console.log( toHexByteString(bytes) );
                if( bytes[idx++] != 0xAA ) return;

                var ChipSelect = 0xFF;
                var Cmd = bytes[idx++];
                var Type = (Cmd >> 3) & 0x7;
                var Opcode = Cmd & 0x7;

                if( Cmd & 0x40 ) ChipSelect = bytes[idx++];

                BankMap.Banks.forEach(function(Bank, nBank) {
                    Bank.Cmd = Cmd;           // 0 ~ 0xFF
                    Bank.ChipSelect = ChipSelect;    // 0x1 ~ 0xFF
                    Bank.RowSelect = 0;     // 0x1 ~ 0x3FF (@PS1120, 10분기)
                    Bank.ColumnSelect = 0;  // 0x1 ~ 0xFFF (@PS1120, 10분기)
                    Bank.Data = 0;
                    Bank.Switches = [];     // 0 ~ 0xFF

                    if( Type == 0 ) {       // All Switch Select.
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                operate_Channel(Opcode, Channel);
                            });
                        });
                    } else if( Type == 1 ) {       // Single Switch Select.
                        Bank.Switches[0] = bytes[idx];
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            operate_Channel(Opcode, Device.Switches[Bank.Switches[0]]);
                            console.log(Device.Switches[Bank.Switches[0]]);
                        });
                    } else if( Type == 2 ) {       // Row Select.(in All Switch)
                        Bank.RowSelect = (((bytes[idx] << 8) | bytes[idx+1]) >> 6);
                        var nRow = Bank.RowSelect;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( nRow & (1 << (9 - (Channel.Number % 10))) ) {
                                    operate_Channel(Opcode, Channel);
                                }
                            });
                        });
                    } else if( Type == 3 ) {       // Row & Column Select.(in Switch)
                        var tmp = (bytes[idx] << 16) | (bytes[idx+1] << 8) | bytes[idx+2];
                        var nRow = (tmp >> 14) & 0x3FF;
                        var nColumn = (tmp >> 2) & 0xFFF;
                        Bank.RowSelect = nRow;
                        Bank.ColumnSelect = nColumn;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( nRow & (1 << (9 - (Channel.Number % 10))) ) {
                                    if( nColumn & (1 << (11 - parseInt(Channel.Number / 10))) ) {
                                        operate_Channel(Opcode, Channel);
                                    }
                                }
                            });
                        });
                    } else if( Type == 4 ) {       // Column Select.(in All Switch)
                        var nColumn = ((bytes[idx] << 8) | bytes[idx+1]) >> 4;
                        Bank.ColumnSelect = nColumn;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( nColumn & (1 << (11 - parseInt(Channel.Number / 10))) ) {
                                    operate_Channel(Opcode, Channel);
                                }
                            });
                        });
                    } else if( Type == 5 ) {       // Column & Row Select.(in Switch)
                        var tmp = (bytes[idx] << 16) | (bytes[idx+1] << 8) | bytes[idx+2];
                        var nColumn = (tmp >> 12) & 0xFFF;
                        var nRow = (tmp >> 2) & 0x3FF;
                        Bank.RowSelect = nRow;
                        Bank.ColumnSelect = nColumn;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( nColumn & (1 << (11 - parseInt(Channel.Number / 10))) ) {
                                    if( nRow & (1 << (9 - (Channel.Number % 10))) ) {
                                        operate_Channel(Opcode, Channel);
                                    }
                                }
                            });
                        });
                    } else if( Type == 6 ) {       // Special Command.
                        var val = bytes[idx];
                        Bank.Data = val;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( (Opcode != 0x7) && (Device.ID == 'x') ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;

                            if( Opcode == 0x1 ) {               // Set Group Type.
                                Device.GROUP = (val >> 5);
                                Device.nChannel = RowColumn[Bank.DeviceType][Device.GROUP][0];
                                Device.nCore = RowColumn[Bank.DeviceType][Device.GROUP][1];
                            } else if( Opcode == 0x2 ) {        // Software Reset.
                                Device.ID = 'x';
                                Device.AD = false;          // AD(Active Discharge)
                                Device.GROUP = 3;       // 0(4분기), 1(6분기), 2(8분기), 3(10분기), 4(12분기), 5(16분기)
                                /* 120-Channel CMOS Analog Switches.
                                 */
                                Device.nChannel = RowColumn[Bank.DeviceType][Device.GROUP][0];
                                Device.nCore = RowColumn[Bank.DeviceType][Device.GROUP][1];
                                Device.nSwitch = ((Bank.DeviceType == 0) ? 120 : ((BankDeviceType == 1) ? 60 : 30));
                                Device.Switches = [];
                                for(var sw=0; sw<Device.nSwitch; sw++) {
                                    var Switch = new Object();
                                    Switch.Number = sw;
                                    Switch.Valid = true;
                                    Switch.OnOff = 0;                   // OFF : 0, ON : 1
                                    Switch.Reject = 1;                  // REJECT : 0, RELEASE : 1
                                    Device.Switches.push(Switch);
                                }
                            } else if( Opcode == 0x4 ) {        // Active Discharge Disable.
                                Device.AD = false;
                            } else if( Opcode == 0x5 ) {        // Active Discharge Enable.
                                Device.AD = true;
                            } else if( Opcode == 0x7 ) {        // Chip Address Assignment.
                                if( Device.ID == 'x' ) {
                                    for(var i=0; i<8; i++) {
                                        var mask = (1 << (7-i));
                                        if( val & mask ) {
                                            Device.ID = i;
                                            val = val & ~mask;
                                            return;
                                        }
                                    }
                                }
                            }
                        });
                        console.log(BankMap);
                    } else if( Type == 7 ) {       // Switches Select.
                        var Switches = bytes.slice(idx, idx+15);
                        Bank.Switches = Switches;
                        Bank.Devices.forEach(function(Device, nDevice) {
                            if( Device.ID == 'x' ) return;

                            if( (ChipSelect & (1<<(7-nDevice))) == 0 ) return;
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Switches[parseInt(Channel.Number/8)] & (1 << (7 - (Channel.Number % 8))) ) {
                                    operate_Channel(Opcode, Channel);
                                }
                            });
                        });
                    }
                });
                console.log(BankMap);
            }

            function operate_Channel(Opcode, Channel)
            {
                if( Opcode == 0 ) {             // Switch OFF
                    if( Channel.Reject == 1 ) Channel.OnOff = 0;
                } else if( Opcode == 1 ) {      // Switch ON
                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                } else if( Opcode == 2 ) {      // Hold OFF
                    if( Channel.Reject == 1 ) {
                        Channel.Reject = 0;
                        Channel.OnOff = 0;
                    }
                } else if( Opcode == 3 ) {      // Hold ON
                    if( Channel.Reject == 1 ) {
                        Channel.Reject = 0;
                        Channel.OnOff = 1;
                    }
                } else if( Opcode == 4 ) {      // Release OFF
                    if( Channel.Reject == 0 ) {
                        Channel.Reject = 1;
                        Channel.OnOff = 0;
                    }
                } else if( Opcode == 5 ) {      // Release ON
                    if( Channel.Reject == 0 ) {
                        Channel.Reject = 1;
                        Channel.OnOff = 1;
                    }
                } else if( Opcode == 6 ) {      // Force OFF
                    Channel.Reject = 1;
                    Channel.OnOff = 0;
                } else if( Opcode == 7 ) {      // Force ON
                    Channel.Reject = 1;
                    Channel.OnOff = 1;
                }
            }

            function run_STACommand(chip, core, cmd, data) {
                console.log(BankMap);
                console.log(`run_STACommand(): chip = ${chip}, core = ${core}, cmd = ${cmd}, data = 0x${data.toString(16)}`);

                var maxChannelperCore = BankMap.Banks[0].Devices[0].nChannel;
                BankMap.Banks.forEach(function(Bank, nBank) {
                    Bank.Chip = chip;
                    Bank.Core = core;
                    Bank.Cmd = cmd;
                    Bank.Data = data;
                });
                if( cmd == 0x0 ) {                // NORMAL : return to normal mode from load mode.
                } else if( cmd == 0x1 ) {         // LOAD_ALL : selects all chips to load(apply) the same commands.
                } else if( cmd == 0x2 ) {         // VIRTUAL : Programming mode for test.
                } else if( (cmd == 0x3) || (cmd == 4) || (cmd == 5) ) {         // CLEAR_ALL
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                if( cmd == 3 ) {            // All OFF.
                                    Channel.OnOff = 0;
                                } else if( cmd == 4 ) {     // All ON
                                    if( Channel.Reject == 1 ) Channel.OnOff = 1;
                                } else if( cmd == 5 ) {     // All ON & Reject clear.
                                    Channel.Reject = 1;
                                    Channel.OnOff = 1;
                                }
                            });
                        });
                    });
                } else if( cmd == 0x10 ) {      // AND_CRL : 특정 Chip에 대해서 모든 Core에 bitwise AND를 실행한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( Channel.Reject == 1 ) {             // reject clear.
                                if( (data & BitMask[Channel.Number & (maxChannelperCore-1)]) == 0 ) {    // data bit clear.
                                    Channel.OnOff = 0;          // Channel.OnOff = Channel.OnOff & 0;   항상 '0' 이다.
//                                } else {
//                                    Channel.OnOff = Channel.OnOff & 0x1;            // bit-wise AND -> 기존값 유지.
                                }
                            }
                        });
                    });
                } else if( cmd == 0x11 ) {      // OR_CRL : 특정 Chip에 대해서 모든 Core에 bitwise OR를 실행한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( Channel.Reject == 1 ) {
                                if( data & BitMask[Channel.Number & (maxChannelperCore-1)] ) {
                                    Channel.OnOff = 1;
//                                } else {
//                                    Channel.OnOff = Channel.OnOff | 0x0;            // bit-wise OR -> 기존값 유지.
                                }
                            }
                        });
                    });
                } else if( cmd == 0x12 ) {      // DIRECT_CRL : 특정 Chip에 대해서 모든 Core에 data 값을 write한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( Channel.Reject == 1 ) {         // when reject clear.
                                Channel.OnOff = (data & BitMask[Channel.Number & (maxChannelperCore-1)]) ? 1 : 0;
                            }
                        });
                    });
                } else if( cmd == 0x13 ) {      // DIRECT_CHL : 모든 Chip에 대해서 모든 Core에 data 값을 write한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices.forEach(function(Device, nDevice) {
                            Device.Switches.forEach(function(Channel, nChannel) {
                                if( Channel.Valid == false ) return;

                                if( Channel.Reject == 1 ) {
                                    Channel.OnOff = (data & BitMask[Channel.Number & (maxChannelperCore-1)]) ? 1 : 0;
                                }
                            });
                        });
                    });
                } else if( cmd == 0x14 ) {      // REJECT_CRL : 특정 Chip에 대해서 data의 Core bit가 '0'이면, core단위로 reject한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( (data & BitMask[parseInt(Channel.Number / maxChannelperCore)]) == 0 ) {
                                Channel.Reject = 0;
                                Channel.OnOff = 0;
                            }
                        });
                    });
                } else if( cmd == 0x18 ) {      // AND_SWL : 특정 Chip에 특정 Core에 bitwise AND를 실행한다.
					console.log("maxChannelperCore = ", maxChannelperCore);
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / maxChannelperCore) ) {
                                if( Channel.Reject == 1 ) {			// not reject
                                    if( (data & BitMask[Channel.Number & (maxChannelperCore-1)]) == 0 ) {
                                        Channel.OnOff = 0;
//                                    } else {
//                                        Channel.OnOff = Channel.OnOff & 0x1;        // bit-wise AND : 기존값 유지.
                                    }
                                }
                            }
                        });
                    });
                } else if( cmd == 0x19 ) {      // OR_SWL : 특정 Chip에 특정 Core에 bitwise OR를 실행한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / maxChannelperCore) ) {
                                if( Channel.Reject == 1 ) {
                                    if( data & BitMask[Channel.Number & (maxChannelperCore-1)] ) {
                                        Channel.OnOff = 1;
//                                    } else {
//                                        Channel.OnOff = Channel.OnOff | 0x1;        // bit-wise OR : 기존값 유지.
                                    }
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1A ) {      // DIRECT_SWL : 특정 Chip에 특정 Core에 data를 Write한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / maxChannelperCore) ) {
                                if( Channel.Reject == 1 ) {
                                    Channel.OnOff = (data & BitMask[Channel.Number & (maxChannelperCore-1)]) ? 1 : 0;
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1C ) {      // REJECT_SWL : 특정 Chip에 특정 Core에 Reject을 bitwise AND를 실행한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / maxChannelperCore) ) {
                                if( (data & BitMask[Channel.Number & (maxChannelperCore-1)]) == 0 ) {
                                    Channel.Reject = 0;
                                    Channel.OnOff = 0;
                                }
                            }
                        });
                    });
                } else if( cmd == 0x1D ) {      // CANCEL_RJT : 특정 Chip에 특정 Core에 Reject을 Clear한다.
                    BankMap.Banks.forEach(function(Bank, nBank) {
                        Bank.Devices[chip].Switches.forEach(function(Channel, nChannel) {
                            if( Channel.Valid == false ) return;

                            if( core == parseInt(Channel.Number / maxChannelperCore) ) {
//                                if( data & BitMask[Channel.Number & (maxChannelperCore-1)] ) {
                                    Channel.Reject = 1;
                                    Channel.OnOff = 0;
//                                }
                            }
                        });
                    });
                }

                console.log(BankMap);
            }

            function drawCommand(chip, core, cmd, data) {
                console.log(`drawCommand() : chip = ${chip}, core = ${core}, cmd = ${cmd}, data = 0x${data.toString(16)}`);
                document.getElementById('svgContainer2').innerHTML = ""; // 기존에 생성된 Wafer Map을 제거한다.
                var svgWidth = 685;
                var svgHeight = 90;
                svg2 = document.createElementNS(xmlns, 'svg');
                $(svg2).attr({
                    id:'Timing', align:'center', width:'100%', height:'100%',
//                    id:'Timing', align:'center', width:1024, height:200,
                    viewBox:`0 0 ${svgWidth} ${svgHeight}`
                });

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M 30 5 l 40 0 l 0 60 l 20 0 l -40 20 l -40 -20 l 20 0 l 0 -60`,
                    stroke:'black', 'stroke-width':1, fill:'violet', onclick:'reload()',
                    class:'FORWORD', visibility:'visible',
                }).appendTo(svg2);

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M 50 5 l 40 20 l -20 0 l 0 60 l -40 0 l 0 -60 l -20 0 l 40 -20`,
                    stroke:'black', 'stroke-width':1, fill:'violet', //onclick:'reload()',
                    class:'BACKWORD', visibility:'hidden',
                }).appendTo(svg2);

                drawTiming(svg2, chip, core, cmd, data, 110, 5);
                // command descript text.
                drawCommandDescript(svg2, chip, core, cmd, data);
                document.getElementById("svgContainer2").appendChild(svg2);
            }

            function drawCommand2(bytes) {
                document.getElementById('svgContainer2').innerHTML = ""; // 기존에 생성된 Wafer Map을 제거한다.
                var svgWidth = 685;
                var svgHeight = 90;
                var widthView = '100%';
                var heightView = '100%';
                svg2 = document.createElementNS(xmlns, 'svg');
                if( deviceName == 'PS1120' ) {
                    svgWidth = 1000;
                    svgHeight = 230;
                    widthView = '100%';
                    heightView = '100%';
                } else if( deviceName == 'PS1060' ) {
                    svgWidth = 530;
                    svgHeight = 230;
                    widthView = '60%';
                    heightView = '100%';
                } else if( deviceName == 'PS1030' ) {
                    svgWidth = 290;
                    svgHeight = 230;
                    widthView = '70%';
                    heightView = '100%';
                }
                $(svg2).attr({
                    id:'Timing', align:'center', width:widthView, height:heightView,
//                    id:'Timing', align:'center', width:'100%', height:'100%',
                    viewBox:`0 0 ${svgWidth} ${svgHeight}`
                });

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M 30 5 l 40 0 l 0 60 l 20 0 l -40 20 l -40 -20 l 20 0 l 0 -60`,
                    stroke:'black', 'stroke-width':1, fill:'violet', onclick:'reload()',
                    class:'FORWORD', visibility:'visible',
                }).appendTo(svg2);

                $(document.createElementNS(xmlns, 'path')).attr({
                    d:`M 50 5 l 40 20 l -20 0 l 0 60 l -40 0 l 0 -60 l -20 0 l 40 -20`,
                    stroke:'black', 'stroke-width':1, fill:'violet', //onclick:'reload()',
                    class:'BACKWORD', visibility:'hidden',
                }).appendTo(svg2);

                drawTiming2(svg2, bytes, 120, 1);
                // command descript text.
//                drawCommandDescript(svg2, chip, core, cmd, data);
                document.getElementById("svgContainer2").appendChild(svg2);
            }

            function drawTiming2(svg, bytes, sx, sy) {
                $(document.createElementNS(xmlns, "defs")).append(
                    $(document.createElementNS(xmlns, "marker")).attr({
                        id:'Triangle', markerWidth:5, markerHeight:5, refX:1, refY:4, orient:'auto', viewBox:'0 0 8 8'
                    }).append(
                        $(document.createElementNS(xmlns, "path")).attr({ d:'M 0 0 L 9 4 L 0 8 z' })
                    )
                ).appendTo(svg);

                var idx = 0;
                var sync = bytes[idx++];
                var cmd = bytes[idx++];
                var Type = (cmd >> 3) & 0x7;
                var Opcode = cmd & 0x7;

                var clock = 8;
                var nBytes = bytes.length;//(bytes.length > 8) ? 8 : bytes.length;
                var nBits = nBytes * 8;
                var half = parseInt(clock/2);
                var x = sx;
                var y = sy;
                var h = 20;
                var dh = 10;

                if( nBytes > 8 ) {
                    $(svg).attr('viewBox', `0 0 ${(bytes.length * 64)+173} 90`);
                } else {
                    $(svg).attr('viewBox', `0 0 685 90`);
                }
//                $(svg).attr('viewBox', `0 0 ${(bytes.length * 64)+173} 90`);

                // signal label & signal line start/end draw.
                for(var line=0; line<3; line++) {
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+10, class:'centerAlign', 'font-size':8
                    }).text((line==0)?'SCLK':((line==1)?'SDI':'CSN')).appendTo(svg);

                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:(line==2)?`M ${x+10} ${y} h 10 v ${h} h ${clock*nBits} v ${-h} h 10`:`M ${x+10} ${(line==2)?y:y+h} h 10 m ${clock*nBits} 0 h 10`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);
                    y = y + (h + dh);
                }

                // nibble dash-line & value draw.
                x = sx + 20;
                y = sy;
                for(var i=0; i<(nBytes * 2); i++) {
                    var val = (i & 1) ? (bytes[i>>1] & 0x0F) : ((bytes[i>>1] & 0xF0) >> 4);
                    $(document.createElementNS(xmlns, 'line')).attr({
                        x1:x, y1:y, x2:x, y2:y+85, stroke:'gray', 'stroke-dasharray':1, 'stroke-opacity':0.5,
                    }).appendTo(svg);

                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x+(clock * 2), y:y+60, class:'centerAlign', fill:'black', 'font-size':8
                    }).text(val.toString(16).toUpperCase()).appendTo(svg);

                    x += (clock * 4);
                }
                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x, y1:y, x2:x, y2:y+85, stroke:'gray', 'stroke-dasharray':1, 'stroke-opacity':0.5,
                }).appendTo(svg);

                // clock draw.
                x = sx + 20;
                y = sy;
                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x, y1:y+h, x2:x+(nBits*clock), y2:y+h, stroke:'black', 'stroke-dasharray':half
                }).appendTo(svg);

                $(document.createElementNS(xmlns, 'line')).attr({
                    x1:x+half, y1:y, x2:x+half+(nBits*clock), y2:y, stroke:'black', 'stroke-dasharray':half
                }).appendTo(svg);

                var preData = 0;
                for(var i=0; i<nBits; i++) {
                    $(document.createElementNS(xmlns, 'line')).attr({
                        x1:x+half, y1:y+h, x2:x+half, y2:(y+5), stroke:'black', 'marker-end':'url(#Triangle)'
                    }).appendTo(svg);

                    $(document.createElementNS(xmlns, 'line')).attr({
                        x1:x+clock, y1:y, x2:x+clock, y2:y+h, stroke:'black'
                    }).appendTo(svg);

                    if( bytes[parseInt(i/8)] & (1<<(7-(i%8))) ) {       // high
                        if( preData == 0 ) {
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x, y1:y+(h+10), x2:x, y2:y+(h+10)+h, stroke:'black'
                            }).appendTo(svg);
                        }
                        $(document.createElementNS(xmlns, 'line')).attr({
                            x1:x, y1:y+(h+10), x2:x+clock, y2:y+(h+10), stroke:'black'
                        }).appendTo(svg);
                        preData = 1;
                    } else {
                        if( preData ) {
                            $(document.createElementNS(xmlns, 'line')).attr({
                                x1:x, y1:y+(h+10), x2:x, y2:y+(h+10)+h, stroke:'black'
                            }).appendTo(svg);
                        }
                        $(document.createElementNS(xmlns, 'line')).attr({
                            x1:x, y1:y+(h+10)+h, x2:x+clock, y2:y+(h+10)+h, stroke:'black'
                        }).appendTo(svg);
                        preData = 0;
                    }
                    x = x + clock;
                }

                idx = 0;
                x = sx + 20;
                y = sy + 54;
                // text y : 60
                if( deviceName == 'SP2003' ) {
                    // Command Pattern.
                    var cmd = bytes[idx++];
                    x += drawFrame(svg, x, y, `0x${cmd.toString(16).toUpperCase()}`, 8*clock, 'red');

                    // Command Pattern.
                    if( (cmd == 0xA0) || (cmd == 0xA1) || (cmd == 0xA2) || (cmd == 0xA3) ) {
                    } else if( cmd == 0xA4 ) {
                        var ctrl = bytes[idx++] >> 4;
                        x += drawFrame(svg, x, y, `0x${ctrl.toString(16).toUpperCase()}`, 4*clock, 'green');
                    } else if( (cmd == 0xA5) || (cmd == 0xA7) ) {
                        var chip = bytes[idx] >> 4;
                        x += drawFrame(svg, x, y, `0x${chip.toString(16).toUpperCase()}`, 4*clock, 'blue');
                        var ctrl = bytes[idx] & 0xF;
                        x += drawFrame(svg, x, y, `0x${ctrl.toString(16).toUpperCase()}`, 4*clock, 'green');
                    } else if( cmd == 0xA6 ) {
                        var chip = bytes[idx] >> 4;
                        x += drawFrame(svg, x, y, `0x${chip.toString(16).toUpperCase()}`, 4*clock, 'blue');
                        var ctrl = ((bytes[idx] & 0xF) << 4) | (bytes[idx+1] >> 4);
                        x += drawFrame(svg, x, y, `0x${ctrl.toString(16).toUpperCase()}`, 8*clock, 'green');
                    } else if( cmd == 0xA8 ) {
                        var select = (bytes[idx] << 8) | bytes[idx+1];
                        x += drawFrame(svg, x, y, `0x${select.toString(16).toUpperCase()}`, 16*clock, 'blue');
                        var ctrl = ((bytes[idx+2] & 0xF0) >> 4);
                        x += drawFrame(svg, x, y, `0x${ctrl.toString(16).toUpperCase()}`, 4*clock, 'green');
                    } else if( cmd == 0xA9 ) {
                        var level = (bytes[idx] << 4) | (bytes[idx+1] >> 4);
                        x += drawFrame(svg, x, y, `${level}`, 12*clock, 'green');
                    } else if( (cmd == 0xAD) || (cmd == 0xAE) ) {
                        var ctrl = bytes[idx++] >> 4;
                        x += drawFrame(svg, x, y, `0x${ctrl.toString(16).toUpperCase()}`, 4*clock, 'green');
                    } else if( cmd == 0xAF ) {
                        var mask = (bytes[idx] << 8) | bytes[idx+1];
                        x += drawFrame(svg, x, y, `0x${mask.toString(16).toUpperCase()}`, 16*clock, 'green');
                    }

                    console.log(`bit count = ${parseInt((x - (sx+20)) / clock)}`);
                    // dummy Pattern.
                    var n = parseInt((x - (sx+20)) / clock);
                    n = (Math.ceil(n/8) * 8) - n;
                    x += (clock * n);

                    // Operate Pattern.
                    len = clock * 16;   // operate
                    x += drawFrame(svg, x, y, 'operate', 16*clock, 'slateBlue');
                    x += drawFrame(svg, x, y, 'shift', 16*clock, 'gray');
                } else {
                    // Sync Pattern.
                    x += drawFrame(svg, x, y, `0x${sync.toString(16).toUpperCase()}`, 8*clock, 'red');

                    // Command Pattern.
                    x += drawFrame(svg, x, y, `0x${cmd.toString(16).toUpperCase()}`, 8*clock, 'blue');

                    if( cmd & 0x40 ) {
                        // Chip Select Pattern.
                        val = bytes[idx++];
                        x += drawFrame(svg, x, y, `0x${val.toString(16).toUpperCase()}`, 8*clock, 'green');
                    }

                    // Row or Column Select Pattern.
                    if( (Type == 2) || (Type == 3) ) {
                        len = clock * 10;                       // nRow
                        val = parseInt($('#RowSelect').val());
                    } else if( (Type == 4) || (Type == 5) ) {
                        len = clock * 12;                       // nColumn
                        val = parseInt($('#ColumnSelect').val());
                    } else len = 0;
                    if( len ) {
                        x += drawFrame(svg, x, y, `0x${val.toString(16).toUpperCase()}`, len, 'Fuchsia');
                    }

                    // Column or Row Select Pattern.
                    if( Type == 3 ) {
                        len = clock * 12;      // nColumn
                        val = BankMap.Banks[0].ColumnSelect;//parseInt($('#ColumnSelect').val());
                    } else if( Type == 5 ) {
                        len = clock * 10; // nRow
                        val = BankMap.Banks[0].RowSelect;//parseInt($('#RowSelect').val());
                    } else if( Type == 1 ) {
                        len = clock * 8;  // switch number
                        val = BankMap.Banks[0].Switches[0];//parseInt($('#NumberSelect').val());
                    } else if( Type == 6 ) {    // Chip Address Assignment, Group Type.
                        if( Opcode == 1 ) {     // Group Type Select.
                            len = clock * 3;  // Group Type
                            val = (BankMap.Banks[0].Data >> 5);
                        } else if( Opcode == 7 ) {
                            len = clock * 8;  // Chip Address Mask
                            val = BankMap.Banks[0].Data;
                        } else {
                            len = 0;
                        }
                    } else if( Type == 7 ) {
                        len = clock * BankMap.Banks[0].Devices[0].nSwitch;  // switch select
//                        console.log(toHexByteString(BankMap.Banks[0].Switches));//parseInt($('#SwitchSelect').val());
                        val = toHexByteString(BankMap.Banks[0].Switches);//parseInt($('#SwitchSelect').val());
                    } else {
                        len = 0;
                    }
                    if( len ) {
                        x += drawFrame(svg, x, y, `0x${val.toString(16).toUpperCase()}`, len, 'orange');
                    }

//                    console.log(`bit count = ${parseInt((x - (sx+20)) / clock)}`);
                    // dummy Pattern.
                    var n = parseInt((x - (sx+20)) / clock);
                    n = (Math.ceil(n/8) * 8) - n;
                    x += (clock * n);

                    // Operate Pattern.
                    len = clock * 8;   // operate
                    x += drawFrame(svg, x, y, 'operate', 8*clock, 'slateBlue');
                    x += drawFrame(svg, x, y, 'shift', 8*clock, 'gray');
                }
            }

            function drawFrame(svg, sx, sy, str, len, color) {
                $(document.createElementNS(xmlns, 'rect')).attr({
                    x:sx, y:sy, rx:3, ry:3, width:len, height:10, fill:'transparent', stroke:color, 'stroke-width':'1',
                }).appendTo(svg);
                $(document.createElementNS(xmlns, 'text')).attr({
                    x:sx+(len/2), y:sy+16, class:'centerAlign', 'font-size':8, fill:color,
                }).text(str).appendTo(svg);

                return len;
            }

            function reload() {
                console.log('reload');
                $('.FORWORD').attr('visibility', 'hidden');
                $('.BACKWORD').attr('visibility', 'visible');
                drawBank(0);
            }

            function drawTiming(svg, chip, core, addr, data, sx, sy) {
                console.log(`chip = 0x${chip.toString(16)}, core = ${core}, addr = 0x${addr.toString(16)}, data = 0x${data.toString(16)}`);
                console.log(`sx = ${sx}, sy = ${sy}`);

                var w = 12;
                var x = sx + (20/2);
                var y = sy;

                if( addr < 0x10 ) {         // 1-clock command.
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+(5), class:'centerAlign', 'font-size':8
                    }).text('CLK').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${x+20} ${y} l 5 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 10 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    y += w;
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+5, class:'centerAlign', 'font-size':8
                    }).text('CSN').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
/*                        d:`M ${x+20} ${y+10} l 40 0 l 0 10 l 95 0`,*/
                        d:`M ${x+20} ${y+10} l 135 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    y += w;
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+5, class:'centerAlign', 'font-size':8
                    }).text('WRN').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${x+20} ${y} l 40 0 l 0 10 l 45 0 l 0 -10 l 50 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    for(var i=0; i<4; i++) {
                        y += w;
                        x = sx + (20/2) + 5;
                        $(document.createElementNS(xmlns, 'text')).attr({
                            x:x, y:y+5, class:'centerAlign', 'font-size':8
                        }).text(`DATA[${3-i}]`).appendTo(svg);

                        for(var j=0; j<3; j++) {
                            var color = ((j==1) ? 'SkyBlue' : 'Gainsboro');

                            if( j == 1 ) {
                                var str = (addr >> (3-i)) & 0x1;

                                $(document.createElementNS(xmlns, 'text')).attr({
                                    x:x+40, y:y+6, class:'centerAlign', 'font-size':7
                                }).text(str).appendTo(svg);
                            }

                            $(document.createElementNS(xmlns, 'path')).attr({
                                d:`M ${x+20} ${y} m 0 5 l 2 -5 l 36 0 l 2 5 l -2 5 l -36 0 l -2 -5`,
                                stroke:'black', 'stroke-width':1, fill:color, 'fill-opacity':0.5,
                            }).appendTo(svg);
                            x += 40
                        }
                        $(document.createElementNS(xmlns, 'path')).attr({
                            d:`M ${x+20} ${y+5} l 10 0`,
                            stroke:'black', 'stroke-width':1,
                        }).appendTo(svg);
                    }
                } else {                    // 2-clock command.
                    addr = addr & 0xF;
					console.log("addr = ", addr);
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+(5), class:'centerAlign', 'font-size':8
                    }).text('SCLK').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${x+20} ${y} l 5 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 20 0 l 0 -10 l 20 0 l 0 10 l 10 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    y += w;
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+5, class:'centerAlign', 'font-size':8
                    }).text('CSN').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
//                        d:`M ${x+20} ${y} l 40 0 l 0 10 l 255 0`,
                        d:`M ${x+20} ${y+10} l 295 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    y += w;
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y+5, class:'centerAlign', 'font-size':8
                    }).text('WRN').appendTo(svg);
                    $(document.createElementNS(xmlns, 'path')).attr({
                        d:`M ${x+20} ${y} l 40 0 l 0 10 l 85 0 l 0 -10 l 170 0`,
                        stroke:'black', 'stroke-width':1, fill:'transparent',
                    }).appendTo(svg);

                    for(var i=0; i<4; i++) {
                        y += w;
                        x = sx + (20/2) + 5;
                        $(document.createElementNS(xmlns, 'text')).attr({
                            x:x, y:y+5, class:'centerAlign', 'font-size':8
                        }).text(`DATA[${3-i}]`).appendTo(svg);

                        const datafill = ['Gainsboro', 'Salmon', 'Pink', 'SkyBlue', 'LightGreen', 'LightGreen', 'Gainsboro'];
                        for(var j=0; j<7; j++) {
                            var color = datafill[j];

                            if( (i == 0) && (j==2) ) {
                                color = datafill[j-1];
                            }

                            var str;
                            if( j == 1 ) {
                                str = (chip >> (4-i)) & 0x1;
//                            str = `Chip ID[${4-i}]`;
                            } else if( j == 2 ) {
                                if( i == 0 ) {
                                    str = chip & 0x1;
//                                str = `Chip ID[0]`;
                                } else {
                                    str = (core >> (3-i)) & 0x1;
//                                str = `Core ID[${3-i}]`;
                                }
                            } else if( j == 3 ) {
                                str = (addr >> (3-i)) & 0x1;
//                            str = `Addr[${3-i}]`;
                            } else if( (j == 4) || (j == 5) ) {
                                str = (data >> (7-(((j-4)*4)+i))) & 0x1;
//                            str = `WData[${7-(((j-4)*4)+i)}]`;
                            }

                            if( (j > 0) && (j<6) ) {
                                $(document.createElementNS(xmlns, 'text')).attr({
                                    x:x+40, y:y+6, class:'centerAlign', 'font-size':7
                                }).text(str).appendTo(svg);
                            }

                            $(document.createElementNS(xmlns, 'path')).attr({
                                d:`M ${x+20} ${y} m 0 5 l 2 -5 l 36 0 l 2 5 l -2 5 l -36 0 l -2 -5`,
                                stroke:'black', 'stroke-width':1, fill:color, 'fill-opacity':0.5,
                            }).appendTo(svg);
                            x += 40
                        }
                        $(document.createElementNS(xmlns, 'path')).attr({
                            d:`M ${x+20} ${y+5} l 10 0`,
                            stroke:'black', 'stroke-width':1,
                        }).appendTo(svg);
                    }
                }
            }

            const oldCommandDescript = [
//                '[ DIRECT_CHP_COR ]\n Changes ON-OFF states of all switches in the specified Device.\n Updates all Cores’ ON-OFF states of the target Device.\n Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n Chip-ID specifies the target Device.\n Core-ID is ignored.\nWData represents the update value for ON-OFF states of all Cores in the target Device.\n\n 0: OFF, 1: ON', // 0x12
                '[ NORMAL ]\n Returns to Normal mode from Load mode(release all chip selection)',   // 0x0
                '[ LOAD_ALL ]\n Select all chips to load(apply) the same commands',   // 0x1
                '[ VIRTUAL ]\n Programming mode for test.',   // 0x2
                '[ CLEAR_ALL ]\n Makes all switches off',   // 0x3
                '[ ENABLE_ALL ]\n Makes all switches on',   // 0x4
                '[ INITIAL_ALL ]\n Initializes all switches releasing reject condition and making them on',   // 0x5
                // 0x6 ~ 0xF
                '', '', '', '', '', '', '', '', '', '',
                '[ AND_CRL ]\n\
                Next siwtch status are produced by bitwise AND operation between\n\
                current switch status and Data[7:0].\n\
                Applied to all cores of the selected chip.\n\n\
                선택된 Chip의 모든 Core에 대해서 Data[7:0]의 각 bit는 Channel[7:0]의 상태를\n\
                제어한다.\n\
                Data bit가 "0"이면, switch는 OFF되고, "1"이면 이전 상태를 유지한다.', // 0x10
                '[ OR_CRL ]\n\
                Next siwtch status are produced by bitwise OR operation between\n\
                current switch status and Data[7:0].\n\
                Applied to all cores of the selected chip.\n\n\
                선택된 Chip의 모든 Core에 대해서 Data[7:0]의 각 bit는 Core의 각 switch와 "OR"한다.\n\
                Data bit가 "1"일때 해당 switch들은 ON되고, "0"이면 이전 상태를 유지한다.', // 0x11
                '[ DIRECT_CRL ]\n\
                Next switch status are produced by Data[7:0] directly.\n\
                Applied to all cores of the selected chip.\n\n\
                선택된 Chip의 모든 Core에 대해서 Data[7:0]의 각 bit는 Core의 각 switch를 On/Off한다.\n\
                Data bit가 "1"이면 switch는 On되고, "0"이면 switch는 Off된다.', // 0x12
                '[ DIRECT_CHL ]\n\
                Next switch status are produced by Data[7:0] directly.\n\
                Applied to all cores of all chips in the same bank.\n\n\
                모든 Chip의 모든 Core에 대해서 Data[7:0]의 각 bit는 Core의 각 switch를 On/Off한다.\n\
                Data bit가 "1"이면 switch는 On되고, "0"이면 switch는 Off된다.', // 0x13
                '[ REJECT_CRL ]\n\
                Reject all switches of selected core by bitwise AND operation between\n\
                current core reject status and Data[7:0].\n\n\
                선택된 Chip에 대해서 Data[7:0]의 각 bit는 각 Core의 모든 switch를 Reject한다.\n\
                Data bit가 "0"이면, 해당 Core의 모든 switch를 reject하고, "1"이면 이전 상태를 유지한다.', // 0x14
                '', // 0x15
                '', // 0x16
                '', // 0x17
                '[ AND_SWL ]\n\
                Next switch status are produced by bitwise AND operation between\n\
                current switch status and Data[7:0].\n\
                Applied to the selected core.\n\n\
                선택된 Chip의 선택된 Core에 대해서 Data[7:0]의 각 bit는 switch를 On/Off한다.\n\
                Data bit가 "0"이면 OFF되고, "1"이면 이전상태를 유지한다.', // 0x18
                '[ OR_SWL ]\n\
                Next switch status are produced by bitwise OR operation between\n\
                current switch status and Data[7:0].\n\
                Applied to the selected core.\n\n\
                선택된 Chip의 선택된 Core에 대해서 Data[7:0]의 각 bit는 switch를 On/Off한다.\n\
                Data bit가 "1"이면 ON되고, "0"이면 이전상태를 유지한다.', // 0x19
                '[ DIRECT_SWL ]\n\
                Next switch status are produced by Data[7:0] directly.\n\
                Applied to the selected core.\n\n\
                선택된 Chip의 선택된 Core에 대해서 Data[7:0]의 각 bit는 switch를 On/Off한다.\n\
                Data bit가 "1"이면 ON되고, "0"이면 OFF된다.', // 0x1A
                '', // 0x1B
                '[ REJECT_SWL ]\n\
                Reject selected switch by bitwise AND operation between\n\
                current switch reject status and Data[7:0]\n\n\
                선택된 Chip의 선택된 Core에 대해서 Data[7:0]의 각 bit는 switch를 reject한다.\n\
                Data bit가 "0"이면 reject되고, "1"이면 이전 상태를 유지한다.', // 0x1C
                '[ CANCEL_RJT ]\n\
                Cancel all switch-reject of selected core\n\n\
                선택된 Chip의 선택된 Core에 대해서 Data[7:0]의 각 bit는 switch의 reject\n\
                상태를 clear한다.\n\
                reject된 switch에 대해서 Data bit가 "1"일때만 clear된다.', // 0x1D
                ];
            const newCommandDescript = [
                '', // 0x0
                '', // 0x1
                '[ RESET_ALL ]\n\
                Turns-off all switches of all chips in the Bank (i.e. OFF state).\n\
                REJECT flags are cleared.',   // 0x2
                '[ CLEAR_ALL ]\n\
                Turns-off all switches of all chips in the Bank (i.e. OFF state).\n\
                REJECT flags are NOT affected.',   // 0x3
                '[ ENABLE_ALL ]\n\
                Turns-on all switches of all chips in the Bank (i.e. ON state).\n\
                Switches with REJECT flags remain in OFF state.',   // 0x4
                '[ INITIAL_ALL ]\n\
                Turns-on all switches of all chips in the Bank (i.e. ON state).\n\
                REJECT flags are cleared.\n\
                Switches with REJECT flags are also changed to ON state.',   // 0x5
                '', // 0x6
                '', // 0x7
                '', // 0x8
                '', // 0x9
                '', // 0xA
                '[ EN1_WCON ]\n\
                First sequence to enable writing to control register.\n\
                Should be followed by EN2_WCON command to enable writing.\n\
                Otherwise, both EN1_WCON and EN2_WCON commands are canceled.', // 0xB
                '[ EN2_WCON ]\n\
                Enables writing to control registers.\n\
                Should be preceded by EN1_WCON.\n\
                If not preceded by EN1_WCON, EN2_WCON is ignored.', // 0xC
                '[ DIS_WCON ]\n\
                Disables writing to control register.', // 0xD
                '', // 0xE
                '', // 0xF
                '', // 0x10
                '[ WR_GCON ]\n\
                Writes to General Control Register.\n\n\
                Chip-ID specifies the target Device.\n\
                Core-ID is ignored.\n\
                WData is the written value to GCON register.', // 0x11
                '[ DIRECT_CHP_COR ]\n\
                Changes ON-OFF states of all switches in the specified Device.\n\
                Updates all Cores’ ON-OFF states of the target Device.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID specifies the target Device, Core-ID is ignored.\n\
                WData represents the update value for ON-OFF states of all Cores in the target \n\
                Device.\n\n\
                0: OFF, 1: ON', // 0x12
                '[ DIRECT_BNK_COR ]\n\
                Changes ON-OFF states of all switches of all STA-Ns in the selected Bank.\n\
                Updates all Cores’ ON-OFF states of all STA-Ns in the selected Bank.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID is ignored. Core-ID is ignored.\n\
                WData represents the update value for ON-OFF states of all Cores in the target \n\
                Device.\n\
                0: OFF, 1: ON', // 0x13
                '[ REJECT_CHP_COR ]\n\
                Changes the REJECT flags of the specified Device.\n\
                ON-OFF states are updated according to REJECT flags’ values.\n\n\
                Chip-ID specifies the target Device. Core-ID is ignored.\n\
                WData[0] represents the update value for REJECT flags of Core0.\n\
                . . .\n\
                WData[7] represents the update value for REJECT flags of Core7.\n\n\
                0: REJECT, 1: No Change.]', // 0x14
                '[ DIRECT_CHP_CHN ]\n\
                Changes ON-OFF states of all switches in the specified Device.\n\
                Updates all Channels’ ON-OFF states of the target Device.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID specifies the target Device. Core-ID is ignored.\n\
                WData represents the update value for ON-OFF states of all Channels in the \n\
                target Device.\n\n\
                0: OFF, 1: ON', // 0x15
                '[ DIRECT_BNK_CHN ]\n\
                Changes ON-OFF states of all switches of all Devices in the selected Bank.\n\
                Updates all Channels’ ON-OFF states of all Devices in the selected Bank.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID is ignored. Core-ID is ignored.\n\
                WData represents the update value for ON-OFF states of all Channels in the \n\
                target Device.\n\n\
                0: OFF, 1: ON', // 0x16
                '[ REJECT_CHP_CHN ]\n\
                Changes the REJECT flags of the specified Device.\n\
                ON-OFF states are updated according to REJECT flags’ values.\n\n\
                Chip-ID specifies the target Device. Core-ID is ignored.\n\
                WData[0] represents the update value for REJECT flags of Channel 0.\n\
                . . .\n\
                WData[7] represents the update value for REJECT flags of Channel 7.\n\n\
                0: REJECT, 1: No Change.', // 0x17
                '[ WR_CLCON ]\n\
                Writes to Current Limiting Control Register.\n\n\
                Chip-ID specifies the target Device. Core-ID is ignored.\n\
                WData is the written value to CLCON register.', // 0x18
                '[ WR_TSDCON ]\n\
                Writes to Thermal Shutdown Control Register.\n\n\
                Chip-ID specifies the target Device. Core-ID is ignored.\n\
                WData is the written value to TSDCON register.', // 0x19
                '[ DIRECT_COR_SW ]\n\
                Changes ON-OFF states of the specified Core in the specified Device.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID specifies the target Device, Core-ID specifies the target Core.\n\
                WData represents the update value for ON-OFF states of the target Core in the \n\
                target Device.\n\n\
                0: OFF, 1: ON', // 0x1A
                '[ DIRECT_CHN_SW ]\n\
                Changes ON-OFF states of the specified Channel in the specified Device.\n\
                Switches whose REJECT flags are ‘1’ remain in OFF state.\n\n\
                Chip-ID specifies the target Device, Core-ID specifies the target Channel.\n\
                WData represents the update value for ON-OFF states of the target Channel \n\
                in the target Device.\n\n\
                0: OFF, 1: ON', // 0x1B
                '[ REJECT_COR_SW ]\n\
                Changes the REJECT flags of the specified Core of the specified Device.\n\
                ON-OFF states are updated according to REJECT flags’ values.\n\n\
                Chip-ID specifies the target Device, Core-ID specifies the target Core.\n\
                WData represents the update value for REJECT flags of the specified Core.\n\n\
                0: REJECT, 1: No Change.', // 0x1C
                '[ REJECT_CHN_SW ]\n\
                Changes the REJECT flags of the specified Channel of the specified Device.\n\
                ON-OFF states are updated according to REJECT flags’ values.\n\n\
                Chip-ID specifies the target Device, Core-ID specifies the target Channel.\n\
                WData represents the update value for REJECT flags of the specified Channel.\n\n\
                0: REJECT, 1: No Change.', // 0x1D
                '', // 0x1E
                '', // 0x1F
                '', // 0x12
                '', // 0x12
                ];
            function drawCommandDescript(svg, chip, core, cmd, data) {
                console.log(`chip = ${chip}, core = ${core}, cmd = 0x${cmd.toString(16)}, data = 0x${data.toString(16)}`);
                var str;

                console.log(deviceName);
                if( (deviceName == 'STA-FX') || (deviceName == 'STA-FX2') || (deviceName == 'STA-1.01A') || (deviceName == 'STA-201') || (deviceName == 'STA-2') || (deviceName == 'STA-3B') ) {
                    str = oldCommandDescript[cmd];
                } else if( (deviceName == 'MCC16') || (deviceName == 'STA-XF') || (deviceName == 'STA-3X') || (deviceName == 'STA-X') || (deviceName == 'STA-10') || (deviceName == 'STA-20') || (deviceName == 'STA-30') || (deviceName == 'STA-N') ) {
                    str = newCommandDescript[cmd];
                } else {
//                    str = newCommandDescript[cmd];
                }

//                console.log(str);
                var result = str.split(/\r?\n/);
//                console.log(result);
                var x = 450;
                var y = 10;
                result.forEach(function(line, idx) {
                    $(document.createElementNS(xmlns, 'text')).attr({
                        x:x, y:y, 'font-weight':'bold', 'font-size':6
                    }).html(line).appendTo(svg);
                    y += 8;
                });
                $(document.createElementNS(xmlns, 'rect')).attr({
                    x:x-3, y:3, width:235, height:y-8,
                    fill:'transparent', stroke:'gray', 'stroke-width':'1', 'fill-opacity':0.5,
                }).appendTo(svg);

//                $(document.createElementNS(xmlns, 'rect')).attr({
//                    x:400, y:10, width:280, height:70,
//                    fill:'transparent', stroke:'gray', 'stroke-width':'1', 'fill-opacity':0.5,
//                }).appendTo(svg);
//                var foreignObject = document.createElementNS(xmlns, 'foreignObject');
//                var div = document.createElement('div');
//                $(div).attr('style', 'width:260; height:80; border:solid 1px #000000; font-size:4px; overflow:auto;').text(str);
//                $(div).attr('style', 'width:260; height:80; font-size:8px; overflow:auto;').text(str);
//                $(foreignObject).attr("x", 400).attr("y", 10).attr("width", 280).attr("height", 70).append(div);
//                svg.appendChild(foreignObject);

                /*
                $(document.createElementNS(xmlns, 'foreignObject')).attr({
                    x:450, y:10, width:230, height:70, stroke:'black', fill:'gray',
                }).append(
                    $(document.createElement('div')).attr({
                        width:230, height:80, 'overflow':'auto',
                    }).css({'text-align':'left', 'font-size':'10px', border:'solid 1px #000000'}).html(str)
                ).appendTo(svg);
                */
            }
        </script>
    </body>
</html>

